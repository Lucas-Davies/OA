<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>Settings — FAOA</title>
<style>
:root{
  --ink:#eef3ff; --ink-dim:#cfd3e1; --bg:#000; --panel:#0f1116; --stroke:rgba(255,255,255,.18);
  --blue:#0A84FF;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);
  font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif}

header{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;padding:12px;background:#111;border-bottom:1px solid var(--stroke)}
header h1{margin:0;font-size:20px;font-weight:900}
.btn{background:var(--blue);color:#000;padding:8px 12px;border-radius:10px;border:1px solid transparent;font-weight:900;cursor:pointer}
.btn.grey{background:#222;color:#fff;border-color:var(--stroke)}
.btn.small{height:36px;padding:6px 10px;border-radius:8px;font-size:13px}

.container{max-width:840px;margin:0 auto;padding:12px}
.section{border:1px solid var(--stroke);border-radius:14px;background:#0b0c10;margin:12px 0}
.section>button.section-head{all:unset;display:flex;align-items:center;justify-content:space-between;width:100%;
  padding:12px 14px;cursor:pointer;font-weight:900}
.section>button.section-head .chev{opacity:.85}
.section .content{padding:10px 14px;border-top:1px solid rgba(255,255,255,.08)}
.section.collapsed .content{display:none}

.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:640px){ .row{grid-template-columns:1fr} }
label{display:block;font-size:12px;color:var(--ink-dim);margin:10px 2px 6px}
select,.input{width:100%;height:42px;padding:0 12px;border-radius:10px;border:1px solid var(--stroke);background:#111;color:var(--ink);font:inherit}
.switch{display:flex;align-items:center;gap:10px}
.switch input{width:18px;height:18px}

.actions{display:flex;gap:10px;justify-content:flex-end;padding:12px 0}

#saveConfirm{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:999;background:rgba(0,0,0,.4);
  -webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}
#saveConfirm.open{display:flex}
#saveConfirm .card{background:#101217;border:1px solid var(--stroke);border-radius:12px;padding:14px 16px;font-weight:900}
</style>
</head>
<body>
<header>
  <button class="btn grey" type="button" id="backBtn">‹ Back</button>
  <h1>Settings</h1>
</header>

<main class="container">
  <!-- Display Settings -->
  <section class="section" aria-labelledby="sec-display">
    <button class="section-head" id="sec-display"><span>Display Settings</span><span class="chev">›</span></button>
    <div class="content">
      <div class="row">
        <div>
          <label for="theme">Theme</label>
          <select id="theme">
            <option value="system">System</option>
            <option value="dark">Dark</option>
            <option value="dim">Dim</option>
            <option value="amoled">AMOLED</option>
          </select>
        </div>
        <div>
          <label for="background">Background</label>
          <select id="background">
            <option value="art-default">Art — Default</option>
            <option value="gradient-1">Gradient — Midnight</option>
            <option value="texture-1">Texture — Canvas</option>
          </select>
        </div>
      </div>

      <!-- New: Home grid view controls -->
      <div class="row">
        <div>
          <label for="viewCols">Home grid — Columns</label>
          <select id="viewCols">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div>
          <label for="viewDensity">Home grid — Density</label>
          <select id="viewDensity">
            <option value="cozy">Cozy</option>
            <option value="comfortable">Comfortable</option>
            <option value="roomy">Roomy</option>
          </select>
        </div>
      </div>

      <div class="switch" style="margin-top:10px">
        <input type="checkbox" id="reduceMotion">
        <label for="reduceMotion">Reduce motion</label>
      </div>

      <div class="actions">
        <button class="btn grey small" type="button" data-close="display">Close</button>
        <button class="btn small" type="button" data-save="display">Save</button>
      </div>
    </div>
  </section>
</main>

<div id="saveConfirm" aria-hidden="true"><div class="card">Saved ✓</div></div>

<script>
(()=>{'use strict';
const store={get:(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}},
             set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const K={settings:'ao_settings', view:'ao_view'};
const $=s=>document.querySelector(s);

/* Settings blob (theme/background/motion) */
function getSettings(){ return store.get(K.settings,{display:{theme:'system',background:'art-default',reduceMotion:false}}); }
function setSettings(s){
  store.set(K.settings,s);
  // poke parent so it can react if listening
  try{ window.parent && window.parent.dispatchEvent(new StorageEvent('storage',{key:K.settings,newValue:JSON.stringify(s)})); }catch{}
}

/* View blob (home grid prefs) — matches home.html */
function defaultView(){
  let cols=3;
  const portrait = window.innerHeight > window.innerWidth;
  if ((window.innerWidth <= 600 && portrait) || window.innerWidth <= 420) cols=1;
  return { cols, density:'comfortable' };
}
function getView(){ return store.get(K.view, defaultView()); }
function setView(v){
  const val = { cols:Math.max(1,Math.min(4,Number(v.cols)||3)), density:(v.density||'comfortable') };
  store.set(K.view,val);
  // notify parent
  try{ window.parent && window.parent.dispatchEvent(new StorageEvent('storage',{key:K.view,newValue:JSON.stringify(val)})); }catch{}
}

/* Saved banner */
function flashSaved(){
  const o=$('#saveConfirm'); o.classList.add('open'); o.setAttribute('aria-hidden','false');
  const close=(e)=>{ if(e.target===o){ o.classList.remove('open'); o.setAttribute('aria-hidden','true'); window.removeEventListener('click',close); } };
  setTimeout(()=>window.addEventListener('click',close,{once:true}),0);
}

/* Fill current values */
const s=getSettings(); const d=s.display||{};
$('#theme').value=d.theme||'system';
$('#background').value=d.background||'art-default';
$('#reduceMotion').checked=!!d.reduceMotion;

const v=getView();
$('#viewCols').value=String(v.cols||3);
$('#viewDensity').value=v.density||'comfortable';

/* Save & Close */
document.body.addEventListener('click',(e)=>{
  if(e.target.matches('[data-save="display"]')){
    // Save general display
    const cur=getSettings();
    cur.display={ theme:$('#theme').value, background:$('#background').value, reduceMotion:$('#reduceMotion').checked };
    setSettings(cur);
    // Save view
    setView({ cols: $('#viewCols').value, density: $('#viewDensity').value });
    flashSaved();
  }
  if(e.target.matches('[data-close="display"]')){
    document.getElementById('sec-display').closest('.section').classList.add('collapsed');
  }
});

/* Collapsible head */
document.getElementById('sec-display').addEventListener('click',()=>{
  document.getElementById('sec-display').closest('.section').classList.toggle('collapsed');
});

/* Back */
document.getElementById('backBtn').addEventListener('click',()=>history.back());
})();
</script>
</body>
</html>