<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="dark">
<title>Profile — FAOA</title>
<style>
:root{
  --bg:#000; --panel:#0f1116; --panel2:#121318; --ink:#eef3ff; --ink-dim:#cfd3e1;
  --muted:rgba(238,243,255,.78); --stroke:rgba(255,255,255,.18);
  --blue:#0A84FF; --red:#ff3b30; --green:#32d74b;
  --bronze:#b87333; --silver:#c0c7d1; --gold:#ffd700; --black:#111;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);
  font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif}

/* Header */
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(0,0,0,.9),rgba(0,0,0,.65));
  -webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border-bottom:1px solid var(--stroke)}
.bar{display:flex;align-items:center;gap:8px;height:52px;padding:0 10px}
.back{width:36px;height:36px;border-radius:10px;border:1px solid var(--stroke);background:#15171f;color:#fff;
  font-weight:900;display:flex;align-items:center;justify-content:center;cursor:pointer}
.bar h1{margin:0;font:900 20px/1 -apple-system}

/* Layout */
main{max-width:980px;margin:0 auto;padding:12px 12px 88px}

/* Big pill hero */
.hero{background:var(--panel);border:1px solid var(--stroke);border-radius:14px;padding:14px;margin:12px 0}
#bigPill{display:inline-flex;align-items:center;gap:12px;padding:14px 16px;border-radius:14px;
  border:1px solid var(--stroke);background:#2a2a2a;color:#fff}
#bigPill .lines{display:flex;flex-direction:column;line-height:1.06}
#bigPill .name{font-weight:900;font-size:18px;max-width:60vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#bigPill .lvl{text-transform:capitalize;font-weight:800;font-size:13px;opacity:.95}

/* Skill row */
.skillRow{display:flex;align-items:center;gap:10px;margin-top:12px;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;height:26px;padding:0 10px;border-radius:999px;border:1px solid rgba(0,0,0,.18);font-weight:900}
select, input[type="text"], input[type="email"], input[type="password"]{
  width:100%;height:44px;padding:0 12px;border-radius:12px;border:1px solid var(--stroke);background:#0b0c12;color:#fff;font:inherit}

/* Collapsibles */
details{background:var(--panel);border:1px solid var(--stroke);border-radius:14px;margin:12px 0;overflow:hidden}
summary{list-style:none;cursor:pointer;display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:14px 14px;font-weight:900}
summary::-webkit-details-marker{display:none}
.chev{width:24px;height:24px;border:1px solid var(--stroke);border-radius:8px;display:flex;align-items:center;justify-content:center;background:#15171f}
details[open] .chev{transform:rotate(90deg)}
.section-body{padding:0 14px 14px}
.field{margin:12px 0}
.labelRow{display:flex;align-items:center;gap:8px;margin:0 2px 6px}
.labelRow .q{width:18px;height:18px;border-radius:50%;border:1px solid var(--stroke);display:inline-flex;align-items:center;justify-content:center;font-size:12px;opacity:.85}
.help{color:var(--ink-dim);font-size:13px}

/* Buttons */
.actions{display:flex;gap:10px;flex-wrap:wrap;margin:16px 2px 0}
.btn{display:inline-flex;align-items:center;justify-content:center;height:44px;padding:0 16px;border-radius:12px;border:1px solid var(--stroke);
  background:#181b22;color:#fff;font-weight:900;cursor:pointer}
.btn.blue{background:var(--blue);border-color:transparent;color:#000}
.btn.red{background:var(--red);border-color:transparent}
.btn.ghost{background:#222}

/* Password sheet */
#pwdSheet{display:none}
#pwdSheet.open{display:block}
.sheet{margin-top:8px;background:var(--panel2);border:1px solid var(--stroke);border-radius:12px;padding:12px}

/* Small text */
small.note{color:var(--ink-dim)}
</style>
</head>
<body>
<header>
  <div class="bar">
    <button class="back" id="backBtn" aria-label="Back">‹</button>
    <h1>Profile</h1>
  </div>
</header>

<main>
  <!-- HERO -->
  <section class="hero">
    <div id="bigPill">
      <div class="lines">
        <div class="name" id="pName">User</div>
        <div class="lvl" id="pLvl">Intermediate</div>
      </div>
    </div>

    <div class="skillRow">
      <div class="badge" id="lvlBadge">Intermediate</div>
      <label for="skill" class="sr-only">Skill Level</label>
      <select id="skill" aria-label="Skill Level">
        <option value="beginner">Beginner (Bronze)</option>
        <option value="intermediate">Intermediate (Silver)</option>
        <option value="advanced">Advanced (Gold)</option>
        <option value="expert">Expert (Black)</option>
      </select>
    </div>
  </section>

  <!-- MY DETAILS -->
  <details>
    <summary>
      My Details
      <span class="chev">›</span>
    </summary>
    <div class="section-body">
      <div class="field">
        <div class="labelRow"><label for="firstName">First Name</label><span class="q" title="Your given name">?</span></div>
        <input id="firstName" type="text" autocomplete="given-name" placeholder="First name">
      </div>
      <div class="field">
        <div class="labelRow"><label for="lastName">Surname</label><span class="q" title="Your family name">?</span></div>
        <input id="lastName" type="text" autocomplete="family-name" placeholder="Surname">
      </div>
      <div class="field">
        <div class="labelRow"><label for="displayName">Display Name</label><span class="q" title="Shown on the avatar pill">?</span></div>
        <input id="displayName" type="text" placeholder="Display name">
      </div>
      <div class="field">
        <div class="labelRow"><label for="email">Email</label><span class="q" title="Used for receipts and notifications">?</span></div>
        <input id="email" type="email" autocomplete="email" placeholder="name@example.com">
      </div>
    </div>
  </details>

  <!-- USERNAME & PASSWORD -->
  <details>
    <summary>
      Username &amp; Password
      <span class="chev">›</span>
    </summary>
    <div class="section-body">
      <div class="field">
        <div class="labelRow"><label for="username">Username</label><span class="q" title="Fixed identifier for this account">?</span></div>
        <input id="username" type="text" placeholder="@username" disabled>
        <small class="help">Username can’t be changed.</small>
      </div>

      <div class="field">
        <button class="btn ghost" id="changePwdBtn" type="button">Change Password</button>
        <div id="pwdSheet" class="sheet">
          <div class="field">
            <div class="labelRow"><label for="pwd1">New Password</label><span class="q" title="Minimum 8 characters">?</span></div>
            <input id="pwd1" type="password" placeholder="New password" autocomplete="new-password">
          </div>
          <div class="field">
            <div class="labelRow"><label for="pwd2">Confirm Password</label><span class="q" title="Re-enter to confirm">?</span></div>
            <input id="pwd2" type="password" placeholder="Confirm password" autocomplete="new-password">
          </div>
          <div class="actions">
            <button class="btn blue" id="savePwdBtn" type="button">Save Password</button>
            <button class="btn" id="cancelPwdBtn" type="button">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </details>

  <!-- MY DATA -->
  <details>
    <summary>
      My Data
      <span class="chev">›</span>
    </summary>
    <div class="section-body">
      <p class="help">View or export your local data.</p>
      <div class="actions">
        <a class="btn blue" href="mydata.html">Open My Data</a>
        <button class="btn" id="exportProfileBtn" type="button">Export Profile</button>
      </div>
    </div>
  </details>

  <!-- Footer actions -->
  <div class="actions">
    <button class="btn" id="cancelBtn" type="button">Cancel</button>
    <button class="btn blue" id="saveBtn" type="button">Save</button>
  </div>

  <small class="note">Saving updates this device only. Home will reflect changes as soon as you close this panel.</small>
</main>

<script>
(()=>{'use strict';
/* ===== Helpers & storage ===== */
const $=s=>document.querySelector(s);
const store={ get:(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}},
              set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };
const K={ profile:'ao_profile' };

const skinByLevel={ beginner:'bronze', intermediate:'silver', advanced:'gold', expert:'black' };
const colorByLevel={ beginner:'var(--bronze)', intermediate:'var(--silver)', advanced:'var(--gold)', expert:'var(--black)' };
const textOn={ bronze:'#fff', black:'#fff', silver:'#0f1116', gold:'#0f1116' };

function cap(s){ return (s||'').replace(/\b\w/g,m=>m.toUpperCase()); }

/* ===== Page state ===== */
let original = store.get(K.profile,{
  firstName:'', lastName:'', displayName:'User', email:'', username:'@user',
  skill:'intermediate', passwordHash:null
});
let working = JSON.parse(JSON.stringify(original));

/* ===== Paint UI from working model ===== */
function paint(){
  $('#firstName').value = working.firstName||'';
  $('#lastName').value = working.lastName||'';
  $('#displayName').value = working.displayName||'';
  $('#email').value = working.email||'';
  $('#username').value = working.username||'';
  $('#skill').value = (working.skill||'intermediate');
  // hero pill
  $('#pName').textContent = working.displayName||'User';
  $('#pLvl').textContent = cap(working.skill||'intermediate');
  const skin=skinByLevel[working.skill]||'silver';
  const bg = getComputedStyle(document.documentElement).getPropertyValue('--'+skin).trim() || '#2a2a2a';
  const txt = textOn[skin] || '#fff';
  const pill=$('#bigPill'); pill.style.background=bg; pill.style.color=txt;
  const badge=$('#lvlBadge'); badge.textContent=cap(working.skill);
  badge.style.background=bg; badge.style.color=txt;
}
paint();

/* ===== Bind inputs to working model ===== */
['firstName','lastName','displayName','email'].forEach(id=>{
  const el=$( '#'+id ); el.addEventListener('input', ()=>{ working[id]=el.value; liveHeroName(); });
});
function liveHeroName(){ $('#pName').textContent = (working.displayName||'User'); }
$('#skill').addEventListener('change', e=>{ working.skill=e.target.value; paint(); });

/* ===== Password change sheet ===== */
const pwdSheet=$('#pwdSheet');
$('#changePwdBtn').addEventListener('click',()=>{ pwdSheet.classList.add('open'); $('#pwd1').focus(); });
$('#cancelPwdBtn').addEventListener('click',()=>{ pwdSheet.classList.remove('open'); $('#pwd1').value=''; $('#pwd2').value=''; });

async function sha256(str){
  const enc=new TextEncoder().encode(str);
  const buf=await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
$('#savePwdBtn').addEventListener('click', async ()=>{
  const a=$('#pwd1').value.trim(), b=$('#pwd2').value.trim();
  if(a.length<8){ alert('Password must be at least 8 characters.'); return; }
  if(a!==b){ alert('Passwords do not match.'); return; }
  working.passwordHash = await sha256(a);
  pwdSheet.classList.remove('open');
  $('#pwd1').value=''; $('#pwd2').value='';
  alert('Password updated (this device).');
});

/* ===== Save / Cancel / Back ===== */
$('#saveBtn').addEventListener('click', ()=>{
  original = JSON.parse(JSON.stringify(working));
  store.set(K.profile, original);
  alert('Saved.');
});
function resetWorking(){
  working = JSON.parse(JSON.stringify(original));
  paint();
}
$('#cancelBtn').addEventListener('click', ()=>{
  if(!confirm('Discard your unsaved changes?')) return;
  resetWorking();
});
$('#backBtn').addEventListener('click', ()=>{
  // treat as close/back; do not auto-save
  if(document.referrer){ history.back(); } else { window.parent && window.parent.postMessage({type:'closeSubSheet'}, '*'); }
});

/* ===== Listen for parent close message (optional, safe no-op on standalone) ===== */
window.addEventListener('message', (ev)=>{ if(ev?.data?.type==='requestProfile'){ window.parent.postMessage({type:'profileSnapshot', profile:store.get(K.profile,original)}, '*'); } });

})();
</script>
</body>
</html>