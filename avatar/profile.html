<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="dark">
<title>Profile — FAOA</title>
<style>
:root{
  --ink:#eef3ff; --ink-dim:#cfd3e1; --muted:rgba(238,243,255,.78);
  --bg:#000; --panel:#0f1116; --stroke:rgba(255,255,255,.18);
  --blue:#0A84FF; --gold:#ffd700; --silver:#c0c7d1; --bronze:#b87333; --red:#ff453a;
}
*{box-sizing:border-box}
html,body{margin:0; background:var(--bg); color:var(--ink); font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif}
main{max-width:960px; margin:0 auto; padding:24px 14px 80px}
h1{margin:0 0 16px; font-size:32px; font-weight:900}
.card{background:var(--panel); border:1px solid var(--stroke); border-radius:14px; padding:14px; margin:14px 0}
label{display:block; font-weight:800; margin:12px 2px 6px}
input[type="text"],input[type="email"],input[type="password"],input[type="url"],select{
  width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--stroke); background:#0b0c10; color:var(--ink)
}
.row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
@media (max-width:700px){.row{grid-template-columns:1fr}}
.hint{color:var(--ink-dim); font-size:.92rem}
.btn{display:inline-flex; align-items:center; justify-content:center; min-width:132px; height:44px; padding:0 16px; border-radius:12px; border:1px solid var(--stroke); background:#121212; color:#fff; font-weight:900; cursor:pointer}
.btn.blue{background:var(--blue); border-color:transparent; color:#000}
.btn.grey{background:#3a3a3a}
.btn.red{background:var(--red); border-color:transparent}
.flex{display:flex; gap:10px; flex-wrap:wrap}
.badge{display:inline-flex; align-items:center; height:22px; padding:0 8px; border-radius:999px; font-weight:900; font-size:12px; border:1px solid rgba(0,0,0,.2); margin-left:8px}
.badge-bronze{background:var(--bronze); color:#fff}
.badge-silver{background:var(--silver); color:#0f1116}
.badge-gold{background:var(--gold); color:#0f1116}
.badge-black{background:#111; color:#fff; border-color:#333}
#avatarPreview{width:112px; height:112px; border-radius:50%; border:3px solid var(--silver); background:#111 center/cover no-repeat}
small.help{display:block; color:var(--muted); margin-top:6px}
table{width:100%; border-collapse:collapse; margin-top:8px}
th,td{padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.08); text-align:left; font-size:14px}
th{color:var(--ink-dim); font-weight:800}
img.thumb{width:40px; height:40px; border-radius:8px; object-fit:cover; border:1px solid var(--stroke)}
</style>
</head>
<body>
<main>
  <h1>Profile</h1>

  <form id="profileForm" onsubmit="return false">
    <div class="card">
      <div class="row">
        <div>
          <div id="avatarPreview" aria-label="Avatar preview"></div>
          <small class="help">The ring colour reflects your skill level.</small>
        </div>
        <div>
          <label>Upload Avatar Image</label>
          <input type="file" id="avatarFile" accept="image/*">
          <small class="help">A private copy is stored locally on this device (no server upload).</small>

          <label style="margin-top:10px">…or Image URL</label>
          <input type="url" id="avatarUrl" placeholder="https://…">
          <small class="help">If both are provided, the uploaded image takes priority.</small>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div><label>First Name</label><input id="firstName" type="text" autocomplete="given-name"></div>
        <div><label>Last Name</label><input id="lastName" type="text" autocomplete="family-name"></div>
      </div>
      <label>Display Name <span id="levelBadge" class="badge badge-silver">Intermediate</span></label>
      <input id="displayName" type="text" placeholder="e.g. Jody Graham" autocomplete="name">

      <label>Username</label>
      <input id="username" type="text" placeholder="@username" autocomplete="nickname">
    </div>

    <div class="card">
      <label>Skill Level</label>
      <select id="skill">
        <option value="beginner">Beginner (Bronze)</option>
        <option value="intermediate">Intermediate (Silver)</option>
        <option value="advanced">Advanced (Gold)</option>
        <option value="expert">Expert (Black)</option>
      </select>
      <small class="help">Applies a matching badge in menus and changes the avatar pillbox ring on Home.</small>
    </div>

    <div class="card">
      <label>Email</label>
      <input id="email" type="email" placeholder="you@example.com" autocomplete="email">
      <div class="row" style="margin-top:10px">
        <div><label>New Password</label><input id="newPass" type="password" autocomplete="new-password"></div>
        <div><label>Confirm Password</label><input id="newPass2" type="password" autocomplete="new-password"></div>
      </div>
      <small class="help">Passwords here are just stored locally unless you wire a backend.</small>
      <div class="flex" style="margin-top:10px">
        <button class="btn" id="resetBtn" type="button">Send Password Reset Email</button>
      </div>
    </div>

    <div class="flex" style="margin-top:6px">
      <button class="btn blue" id="saveBtn" type="button">Save</button>
      <button class="btn grey" id="closeBtn" type="button">Close</button>
    </div>
  </form>

  <div class="card" id="uploadsCard" hidden>
    <strong>Uploaded Images</strong>
    <table>
      <thead><tr><th>Preview</th><th>Name</th><th>Added</th></tr></thead>
      <tbody id="uploadsBody"></tbody>
    </table>
  </div>
</main>

<script>
(()=>{'use strict';
/* Keys */
const K={ profile:'ao_profile', uploads:'ao_uploads' };

/* Helpers */
const $=s=>document.querySelector(s);
const cap=s=>(s||'').replace(/\b\w/g,m=>m.toUpperCase());
const ringByLevel={ beginner:'#b87333', intermediate:'#c0c7d1', advanced:'#ffd700', expert:'#111' };
const badgeClassByLevel={ beginner:'badge-bronze', intermediate:'badge-silver', advanced:'badge-gold', expert:'badge-black' };
const store={ get:(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}},
              set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)) };

/* Load existing */
const p = store.get(K.profile,{ skill:'intermediate' });
$('#firstName').value = p.firstName||'';
$('#lastName').value  = p.lastName||'';
$('#displayName').value = p.displayName||'';
$('#username').value = p.username||'';
$('#email').value = p.email||'';
$('#skill').value = p.skill||'intermediate';
$('#avatarUrl').value = p.avatarUrl||'';
const avatarPreview = $('#avatarPreview');
function paintAvatarPreview(){
  const lvl=$('#skill').value||'intermediate';
  avatarPreview.style.borderColor = ringByLevel[lvl]||'#0A84FF';
  if(p.avatarDataUrl){ avatarPreview.style.backgroundImage=`url(${p.avatarDataUrl})`; }
  else if(p.avatarUrl){ avatarPreview.style.backgroundImage=`url(${p.avatarUrl})`; }
  else { avatarPreview.style.backgroundImage='none'; }
}
paintAvatarPreview();

/* Badge preview */
const badge = $('#levelBadge');
function paintBadge(){
  const lvl=$('#skill').value||'intermediate';
  badge.textContent = cap(lvl);
  badge.className = 'badge ' + (badgeClassByLevel[lvl]||'badge-silver');
}
paintBadge();
$('#skill').addEventListener('change', ()=>{ paintBadge(); paintAvatarPreview(); });

/* File upload -> dataURL + save in ao_uploads list */
let pendingDataUrl = null;
$('#avatarFile').addEventListener('change', e=>{
  const f=e.target.files?.[0]; if(!f) return;
  const reader=new FileReader();
  reader.onload=ev=>{
    pendingDataUrl = ev.target.result;
    avatarPreview.style.backgroundImage = `url(${pendingDataUrl})`;
  };
  reader.readAsDataURL(f);
});

/* Render uploads list */
function paintUploads(){
  const list = store.get(K.uploads,[]);
  const body = $('#uploadsBody'); body.innerHTML='';
  if(!list.length){ $('#uploadsCard').hidden=true; return; }
  $('#uploadsCard').hidden=false;
  list.forEach(u=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td><img class="thumb" src="${u.dataUrl}"></td><td>${u.name}</td><td>${new Date(u.ts).toLocaleString()}</td>`;
    body.appendChild(tr);
  });
}
paintUploads();

/* Save */
$('#saveBtn').addEventListener('click', ()=>{
  const data={
    firstName: $('#firstName').value.trim(),
    lastName:  $('#lastName').value.trim(),
    displayName: $('#displayName').value.trim(),
    username: $('#username').value.trim(),
    email: $('#email').value.trim(),
    skill: $('#skill').value,
    avatarUrl: $('#avatarUrl').value.trim()
  };
  // password fields are local-only metadata
  const n1=document.getElementById('newPass').value, n2=document.getElementById('newPass2').value;
  if(n1||n2){ if(n1!==n2){ alert('Passwords do not match.'); return; } data._pwSetAt=Date.now(); }

  // uploaded image wins
  if(pendingDataUrl){ data.avatarDataUrl=pendingDataUrl;
    const uploads = store.get(K.uploads,[]);
    uploads.unshift({id: Date.now(), name:`avatar-${new Date().toISOString()}`, dataUrl: pendingDataUrl, ts: Date.now()});
    store.set(K.uploads, uploads);
  }else if(p.avatarDataUrl){ data.avatarDataUrl=p.avatarDataUrl; } // keep existing one unless URL is used

  store.set(K.profile, data);
  alert('Saved!');
});

/* Close helper for slide-over use */
$('#closeBtn').addEventListener('click', ()=>{ if(window.top && window.top!==window) { /* in iframe */ } window.history.back(); });

/* Reset email (mailto fallback) */
$('#resetBtn').addEventListener('click', ()=>{
  const email = ($('#email').value||'').trim();
  if(!email) return alert('Please enter your email first.');
  const subject=encodeURIComponent('Password reset');
  const body=encodeURIComponent('Hi,\n\nA password reset was requested for your account.\n\n(Configure a backend endpoint to send a real link.)');
  location.href=`mailto:${email}?subject=${subject}&body=${body}`;
});
})();
</script>
</body>
</html>