<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>Home — FAOA</title>

<style>
:root{
  --ink:#eef3ff; --ink-dim:#cfd3e1; --muted:rgba(238,243,255,.78);
  --bg:#000; --panel:#0a0c10; --stroke:rgba(255,255,255,.22);
  --blue:#0A84FF; --green:#32d74b; --red:#ff3b30; --chip:#1b1f2a;
  --gap:12px; --r:16px; --maxw:1240px; --nav-h:68px; --btn-h:44px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
  font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif;
  overscroll-behavior-y:contain; overflow-x:hidden}
a{color:inherit;text-decoration:none}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
.bg{position:fixed;inset:0;z-index:-1;background:#000 url("./assets/home-bg.jpg") center/cover no-repeat}

/* Top bar */
.nav{position:fixed;top:0;left:0;right:0;height:var(--nav-h);display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:8px 12px;z-index:50;background:linear-gradient(180deg,rgba(0,0,0,.9),rgba(0,0,0,.55) 60%,rgba(0,0,0,.3));
  -webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px)}
.nav-left{display:flex;gap:8px;align-items:center}
.btn-tab{display:inline-flex;align-items:center;justify-content:center;min-width:110px;height:44px;padding:0 14px;border-radius:12px;border:1px solid var(--stroke);
  background:rgba(0,0,0,.55);color:var(--ink);font-weight:900;cursor:pointer}
.btn-tab.is-active{background:var(--blue);border-color:transparent;color:#000}
@media (max-width:420px){.btn-tab{min-width:0;padding:0 12px;font-size:14px}}

/* Avatar pill (color by level) */
.avatarTab{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;padding:6px 12px;border-radius:12px;min-width:132px;height:44px;
  font-weight:900;line-height:1.1;text-align:left;cursor:pointer;border:1px solid var(--stroke);background:#222;color:#eef3ff}
.avatarTab .name{font-size:15px;font-weight:900}
.avatarTab .lvl{font-size:12px;opacity:.95}

/* Layout */
.wrap{max-width:var(--maxw);margin:0 auto;padding:calc(var(--nav-h) + env(safe-area-inset-top) + 10px) 14px 120px}

/* Grid of heroes */
.grid{display:grid;gap:12px}
@media (max-width:600px){.grid{grid-template-columns:1fr}}
@media (min-width:601px) and (max-width:900px){.grid{grid-template-columns:1fr 1fr}}
@media (min-width:901px) and (max-width:1200px){.grid{grid-template-columns:1fr 1fr 1fr}}
@media (min-width:1201px){.grid{grid-template-columns:1fr 1fr 1fr 1fr}}

/* Hero card */
.hero{position:relative;overflow:visible;background:#060708;border:1px solid var(--stroke);border-radius:16px;padding:16px;min-height:120px;
  box-shadow:0 0 0 1px rgba(255,255,255,.06) inset}
.hero .num{font-weight:900;font-size:16px;opacity:.9}
.hero .cta-left{position:absolute;left:16px;bottom:16px}
.btn{display:inline-flex;align-items:center;justify-content:center;min-width:120px;height:40px;padding:0 14px;border-radius:12px;border:1px solid var(--stroke);
  font-weight:900;background:#0f1116;color:var(--ink);cursor:pointer}
.btn.blue{background:var(--blue);border-color:transparent;color:#000}

/* Admin chips (top-right of hero) */
.ctrls{position:absolute;top:10px;right:10px;display:flex;gap:8px;z-index:10}
.chip{height:28px;padding:0 10px;border-radius:999px;border:1px solid var(--stroke);background:var(--chip);color:#fff;font-weight:800;font-size:12px;cursor:pointer}
.badge-live{background:#0a0}
.badge-off{background:#b00020}

/* Move popover (anchored to body; no drift) */
.move{position:relative}
.move-menu{position:fixed;top:-9999px;left:-9999px;background:#0f0f12;border:1px solid var(--stroke);border-radius:10px;padding:6px;display:block;
  visibility:hidden;opacity:0;z-index:9999;min-width:220px;transition:opacity .12s ease,visibility .12s ease}
.move-menu.open{visibility:visible;opacity:1}
.move-menu button{display:block;width:100%;text-align:left;padding:8px 10px;border-radius:8px;border:1px solid var(--stroke);background:#141416;color:#fff;
  font-weight:800;font-size:12px;margin:4px 0;cursor:pointer}

/* Avatar Drawer */
#avatarSheet{position:fixed;inset:0;z-index:60;display:none;background:rgba(0,0,0,.45);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}
#avatarSheet.open{display:block}
#avatarSheet .panel{position:absolute;top:calc(var(--nav-h) + 6px);right:12px;width:320px;max-height:70vh;overflow:auto;background:#0f1116;border:1px solid var(--stroke);border-radius:14px;padding:12px}
.menu a{display:flex;align-items:center;justify-content:space-between;padding:12px 10px;border-bottom:1px solid rgba(255,255,255,.08)}
.menu a:last-child{border-bottom:none}

/* Subsheet (iframe) */
#subSheet{position:fixed;inset:0;z-index:70;display:none;background:rgba(0,0,0,.55);-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}
#subSheet.open{display:block}
#subSheet .inner{position:absolute;top:calc(var(--nav-h) + 6px);right:12px;width:min(820px,calc(100% - 24px));height:min(78vh,calc(100% - (var(--nav-h) + 24px)));
  background:#0f1116;border:1px solid var(--stroke);border-radius:14px;padding:12px;display:flex;flex-direction:column}
.sheet-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:4px 4px 10px}
.sheet-close{width:36px;height:36px;border-radius:10px;border:1px solid var(--stroke);background:#121212;color:#fff;font-weight:900;cursor:pointer}
#subFrame{flex:1 1 auto;width:100%;height:100%;border:none;border-radius:12px;background:#0b0c10;overflow:hidden}

/* Archive footer (admin-only) */
.archive{margin-top:24px;border-top:1px solid rgba(255,255,255,.16);padding-top:12px}
.archive .head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
.archive .title{font-weight:900;opacity:.95}
.archive .count{opacity:.75;font-weight:800}
.archive .list{display:grid;gap:8px}
@media (max-width:600px){.archive .list{grid-template-columns:1fr}}
@media (min-width:601px) and (max-width:900px){.archive .list{grid-template-columns:1fr 1fr}}
@media (min-width:901px) and (max-width:1200px){.archive .list{grid-template-columns:1fr 1fr 1fr}}
@media (min-width:1201px){.archive .list{grid-template-columns:1fr 1fr 1fr 1fr}}
.row{position:relative;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid var(--stroke);
  background:#0d0d10;border-radius:10px}
.row .num{font-weight:900}
.row .ctrls{position:static}
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>

<header class="nav" role="navigation">
  <div class="nav-left">
    <button class="btn-tab is-active" aria-selected="true">Courses</button>
  </div>
  <div class="nav-right">
    <button id="avatarTab" class="avatarTab" aria-haspopup="dialog" aria-expanded="false">
      <span class="name" id="avatarName">User</span>
      <span class="lvl" id="avatarLvl">Admin</span>
    </button>
  </div>
</header>

<main class="wrap">
  <section class="grid" id="pageGrid"></section>

  <!-- Admin-only archive footer -->
  <section class="archive" id="archiveSection" style="display:none">
    <div class="head">
      <div class="title">Archive</div>
      <div class="count" id="archiveCount">0</div>
    </div>
    <div class="list" id="archiveList"></div>
  </section>
</main>

<!-- Avatar Drawer -->
<div id="avatarSheet" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="panel" role="document">
    <nav class="menu">
      <a href="avatar/profile.html" data-pop="Profile">Profile<span>›</span></a>
      <a href="avatar/settings.html" data-pop="Settings">Settings<span>›</span></a>
      <a href="avatar/mydata.html" data-pop="My Data">My Data<span>›</span></a>
      <a href="avatar/statistics.html" data-pop="Statistics">Statistics<span>›</span></a>
      <a href="avatar/usersearch.html" data-pop="User Search">User Search<span>›</span></a>
      <a href="#" id="cfgToggle">Config Mode<span>⌁</span></a>
    </nav>
  </div>
</div>

<!-- Subsheet -->
<div id="subSheet" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="inner" role="document">
    <div class="sheet-head">
      <h2 id="sheetTitle">—</h2>
      <button class="sheet-close" id="sheetClose" aria-label="Close">×</button>
    </div>
    <iframe id="subFrame" title="Panel"></iframe>
  </div>
</div>

<script>
(()=>{'use strict';
/* ===== utils & storage ===== */
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const store={get:(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}},
             set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const K={ profile:'ao_profile', settings:'ao_settings' };

/* Role & avatar paint */
const ROLE_SKINS={
  bronze:{pill:'#b87333', text:'#111'},
  silver:{pill:'#c0c7d1', text:'#0b0c10'},
  gold:{pill:'#ffd700',  text:'#0b0c10'},
  support:{pill:'#6a4cff',text:'#fff'},
  director:{pill:'#444',  text:'#fff'},
  admin:{pill:'#0A84FF',  text:'#0b0c10'}
};
function currentRole(){ const p=store.get(K.profile,{skill:'admin'}); return (p.skill||'admin').toLowerCase(); }
function isAdmin(){ return currentRole()==='admin'; }
function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}
function applyProfile(){
  const p=store.get(K.profile,{displayName:'User',skill:'admin'});
  const role=(p.skill||'admin').toLowerCase();
  $('#avatarName').textContent=p.displayName||'User';
  $('#avatarLvl').textContent=cap(role);
  const skin=ROLE_SKINS[role]||ROLE_SKINS.silver;
  const pill=$('#avatarTab'); pill.style.background=skin.pill; pill.style.color=skin.text;
}
applyProfile();
window.addEventListener('storage',e=>{ if(e.key===K.profile) applyProfile(); });

/* Avatar drawer + subsheet */
const avatarBtn=$('#avatarTab'), avatarSheet=$('#avatarSheet');
function openDrawer(){ avatarSheet.classList.add('open'); avatarSheet.setAttribute('aria-hidden','false'); avatarBtn.setAttribute('aria-expanded','true'); }
function closeDrawer(){ avatarSheet.classList.remove('open'); avatarSheet.setAttribute('aria-hidden','true'); avatarBtn.setAttribute('aria-expanded','false'); }
avatarBtn.addEventListener('click', openDrawer);
avatarSheet.addEventListener('click', e=>{ if(e.target===avatarSheet) closeDrawer(); });

const subSheet=$('#subSheet'), subFrame=$('#subFrame'), sheetTitle=$('#sheetTitle');
function openSubSheet(title,url){
  sheetTitle.textContent=title;
  if(!url){ alert('401 — Not linked yet'); return; }
  subFrame.src=url+(url.includes('?')?'&':'?')+'v='+Date.now();
  subSheet.classList.add('open'); subSheet.setAttribute('aria-hidden','false');
}
function closeSubSheet(){ subSheet.classList.remove('open'); subSheet.setAttribute('aria-hidden','true'); subFrame.src='about:blank'; }
$('#sheetClose').addEventListener('click', closeSubSheet);
subSheet.addEventListener('click', e=>{ if(e.target===subSheet) closeSubSheet(); });
$$('#avatarSheet [data-pop]').forEach(a=>a.addEventListener('click',e=>{
  e.preventDefault(); closeDrawer(); openSubSheet(a.dataset.pop, a.getAttribute('href'));
}));
$('#cfgToggle').addEventListener('click', e=>{ e.preventDefault(); document.body.classList.toggle('config-on'); closeDrawer(); });

/* ===== data model: 6 page, 44 archived =====
   heroFlags[id] = { state:'live'|'off', place:'page'|'archive' }
*/
function defaults(){
  const heroFlags={};
  for(let i=1;i<=6;i++)  heroFlags[`co-${i}`] ={state:'live',place:'page'};
  for(let i=7;i<=50;i++) heroFlags[`co-${i}`]={state:'off', place:'archive'};
  return { heroFlags };
}
function getSettings(){ return store.get(K.settings, defaults()); }
function saveSettings(s){ store.set(K.settings,s); }

const idNum = id => (id.match(/\d+/)||['?'])[0];

/* Allowed moves */
function moveOptionsFor(place){ return place==='page' ? ['archive'] : ['page']; }

/* Build hero card for page */
function heroCard(id){
  const n=idNum(id);
  const s=getSettings(); const f=s.heroFlags[id]||{state:'off',place:'archive'};
  const live=f.state==='live';
  const el=document.createElement('article'); el.className='hero'; el.dataset.heroId=id; el.dataset.place='page';
  el.innerHTML=`
    <span class="num">#${n}</span>
    <div class="ctrls">
      <button class="chip ${live?'badge-live':'badge-off'}" data-act="toggle" ${isAdmin()?'':'style="display:none"'}>${live?'Live':'Offline'}</button>
      <div class="move" ${isAdmin()?'':'style="display:none"'}>
        <button class="chip" data-act="move">Move</button>
        <div class="move-menu"></div>
      </div>
    </div>
    <div class="cta-left"><button class="btn blue" data-act="enter">Start</button></div>`;
  const menu=el.querySelector('.move-menu');
  moveOptionsFor('page').forEach(opt=>{
    const b=document.createElement('button'); b.textContent=`Move to ${cap(opt)}`; b.dataset.to=opt; menu.appendChild(b);
  });
  return el;
}

/* Build archive row */
function archiveRow(id){
  const n=idNum(id);
  const s=getSettings(); const f=s.heroFlags[id]||{state:'off',place:'archive'};
  const live=f.state==='live';
  const row=document.createElement('div'); row.className='row'; row.dataset.heroId=id; row.dataset.place='archive';
  row.innerHTML=`
    <span class="num">#${n}</span>
    <div class="ctrls">
      <button class="chip ${live?'badge-live':'badge-off'}" data-act="toggle" ${isAdmin()?'':'style="display:none"'}>${live?'Live':'Offline'}</button>
      <div class="move" ${isAdmin()?'':'style="display:none"'}>
        <button class="chip" data-act="move">Move</button>
        <div class="move-menu"></div>
      </div>
    </div>`;
  const menu=row.querySelector('.move-menu');
  moveOptionsFor('archive').forEach(opt=>{
    const b=document.createElement('button'); b.textContent=`Move to ${cap(opt)}`; b.dataset.to=opt; menu.appendChild(b);
  });
  return row;
}

/* Paint page heroes: render ALL that are place:'page' for admins, but ONLY 'live' for non-admins */
function paintPage(){
  const s=getSettings(); const host=$('#pageGrid'); host.innerHTML='';
  // collect all page heroes by number order
  const ids = Object.keys(s.heroFlags)
    .filter(id=>s.heroFlags[id].place==='page')
    .sort((a,b)=>parseInt(idNum(a))-parseInt(idNum(b)));
  ids.forEach(id=>{
    const f=s.heroFlags[id];
    if(!isAdmin() && f.state!=='live') return; // hide offline from non-admins
    host.appendChild(heroCard(id));
  });
}

/* Paint archive (admin-only) */
function paintArchive(){
  const isA=isAdmin();
  $('#archiveSection').style.display = isA ? '' : 'none';
  if(!isA) return;
  const s=getSettings(), flags=s.heroFlags;
  const list=$('#archiveList'); list.innerHTML='';
  Object.keys(flags)
    .filter(id=>flags[id].place==='archive')
    .sort((a,b)=>parseInt(idNum(a))-parseInt(idNum(b)))
    .forEach(id=>list.appendChild(archiveRow(id)));
  $('#archiveCount').textContent = list.children.length;
}

/* ===== Stable floating move menu ===== */
let openMenu=null;
function openMoveMenu(btn, menu){
  if(!menu.children.length){ return; }
  menu.classList.add('open');
  const r=btn.getBoundingClientRect();
  const mw=Math.max(220, menu.offsetWidth||220);
  let top = r.bottom + 6;
  let left = r.right - mw;
  left = Math.max(8, Math.min(left, window.innerWidth - mw - 8));
  menu.style.top = `${top}px`;
  menu.style.left = `${left}px`;
  openMenu=menu;
}
function closeMoveMenu(){
  if(openMenu){
    openMenu.classList.remove('open');
    openMenu.style.top='-9999px'; openMenu.style.left='-9999px';
    openMenu=null;
  }
}
window.addEventListener('scroll', closeMoveMenu, true);
window.addEventListener('resize', closeMoveMenu);

/* ===== Global click handlers ===== */
document.addEventListener('click',(e)=>{
  // Start → 401 until linked
  const enter=e.target.closest('[data-act="enter"]');
  if(enter){
    const host=e.target.closest('[data-hero-id]'); const id=host?.dataset.heroId||'';
    openSubSheet(`Course #${idNum(id)}`, null);
    return;
  }

  // Live/Offline toggle (admin)
  const tgl=e.target.closest('[data-act="toggle"]');
  if(tgl && isAdmin()){
    const host=e.target.closest('[data-hero-id], .row'); const id=host.dataset.heroId;
    const s=getSettings(); const cur=s.heroFlags[id];
    s.heroFlags[id]={...cur, state:(cur.state==='live'?'off':'live')};
    saveSettings(s); paintPage(); paintArchive(); return;
  }

  // Open move menu (admin)
  const mvBtn=e.target.closest('[data-act="move"]');
  if(mvBtn && isAdmin()){
    e.stopPropagation();
    const wrap=mvBtn.closest('.move'); const menu=wrap.querySelector('.move-menu');
    if(menu.classList.contains('open')) closeMoveMenu(); else { closeMoveMenu(); openMoveMenu(mvBtn, menu); }
    return;
  }

  // Choose destination
  if(e.target.matches('.move-menu button')){
    e.stopPropagation();
    const to=e.target.dataset.to;
    const holder = (openMenu && openMenu.closest('[data-hero-id], .row')) || e.target.closest('[data-hero-id], .row');
    const id=holder.dataset.heroId;
    moveHero(id, to);
    closeMoveMenu();
    return;
  }

  // click-away
  if(openMenu && !e.target.closest('.move-menu') && !e.target.closest('[data-act="move"]')) closeMoveMenu();
});

/* Movement engine (page <-> archive only) */
function moveHero(id, dest){
  const s=getSettings(); const cur=s.heroFlags[id]||{state:'off',place:'archive'};
  const from=cur.place;
  const allowed = (from==='page'?['archive']:['page']);
  if(!allowed.includes(dest)) return;
  s.heroFlags[id]={...cur, place:dest};
  saveSettings(s);
  paintPage(); paintArchive();
}

/* Init */
paintPage(); paintArchive();
})();
</script>
</body>
</html>