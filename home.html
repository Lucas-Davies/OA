<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>Home — FAOA</title>

<!-- ===== DESIGN TOKENS & RESETS ===== -->
<style>
:root{
  --ink:#eef3ff; --ink-dim:#cfd3e1; --muted:rgba(238,243,255,.78);
  --bg:#000; --stroke:rgba(255,255,255,.18);
  --blue:#0A84FF; --green:#32d74b; --gold:#ffd700; --silver:#c0c7d1; --red:#ff453a;
  --gap:12px; --r:14px; --maxw:1240px; --nav-h:68px;

  /* controls alignment between button & chips */
  --btn-h:44px;         /* must match .btn height */
  --btn-bottom:14px;    /* must match .cta-left bottom */
  --chip-h:36px;        /* visual height of chip pills */
}
*{box-sizing:border-box}
html,body{height:100%; overflow-x:hidden}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif;
  -webkit-user-select:none; user-select:none; -webkit-touch-callout:none;
}
a{color:inherit; text-decoration:none}

/* ==== Page background image (no ?v params) ==== */
.bg{
  position:fixed; inset:0; z-index:-1;
  background:#000 url("./assets/home-bg.jpg") center/cover no-repeat;
}

.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0 }
.hide{ display:none !important }
.section-title{ margin:18px 2px 8px; font-size:18px; font-weight:900 }
.wrap{max-width:var(--maxw); margin:0 auto; padding:10px 14px 80px}

/* Buttons */
.btn{ display:inline-flex; align-items:center; justify-content:center; min-width:156px; height:var(--btn-h); padding:0 16px;
      border-radius:12px; border:0; font-weight:900; cursor:pointer }
.btn.blue{ background:var(--blue); color:#fff }
.btn.green{ background:var(--green); color:#000 }
.btn.gold{ background:var(--gold); color:#0f1116 }
.btn.grey{ background:#3a3a3a; color:#fff }
.btn[disabled]{ opacity:.55; cursor:not-allowed }

/* ===== HEADER (Tabs + Avatar) ===== */
.nav{
  position:sticky; top:0; left:0; right:0; height:var(--nav-h);
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:8px 12px; z-index:30; overflow:visible;
  background:linear-gradient(180deg, rgba(0,0,0,.85), rgba(0,0,0,.35) 60%, transparent);
  -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px);
}
.nav-left{display:flex; gap:8px; align-items:center; flex:1 1 auto; min-width:0}
.nav-right{margin-left:auto; display:flex; align-items:center}
.btn-tab{
  display:inline-flex; align-items:center; justify-content:center;
  flex:1 1 0; min-width:0; max-width:120px;
  height:44px; padding:0 12px;
  border-radius:12px; border:1px solid var(--stroke);
  background:rgba(0,0,0,.55); color:var(--ink); font-weight:900; cursor:pointer;
  transition:transform .06s ease, filter .15s ease;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  font-size:clamp(13px, 3.2vw, 16px);
}
.btn-tab:active{transform:translateY(1px)}
.btn-tab.is-active{background:var(--blue); border-color:transparent; color:#fff}

/* Avatar special tab (simple, no points) */
.avatarTab{ position:relative; display:inline-flex; align-items:center; gap:10px; padding-right:56px; height:44px; background:var(--silver); color:#0f1116 }
.avatarTab .dot{
  position:absolute; right:0; top:0; bottom:0; width:44px; border-left:1px solid var(--stroke);
  border-top-right-radius:22px; border-bottom-right-radius:22px; display:grid; place-items:center; font-weight:900;
  transform: translateX(1px); background:linear-gradient(135deg,#d9dee6,#b7bec9)
}

@media (max-width:390px){
  .btn-tab{ max-width:96px; padding:0 10px; }
  #avatarTab{ padding-right:52px; }
}

/* ===== HERO COMPONENT (base styles) ===== */
.hero{
  position:relative; overflow:hidden; background:#000;
  border:1px solid var(--stroke); border-radius:16px;
  padding:16px; margin:12px 0;
}
.hero .title{ margin:0 0 6px; font-weight:900; font-size:20px; display:flex; align-items:center; gap:8px }
.hero .meta{ margin:0 0 6px; color:var(--ink-dim) }
.hero .desc{ margin:8px 0 56px; color:var(--muted) }
.cta-left{ position:absolute; left:16px; bottom:var(--btn-bottom); display:flex; gap:10px }

/* ===== Daily hero — glossy skins + level text ===== */
#dailyHero{ color:#eef3ff; position:relative; }
#dailyHero::after{ /* global gloss highlight overlay */
  content:""; position:absolute; inset:0; pointer-events:none;
  background:linear-gradient(120deg,
    rgba(255,255,255,.35) 0%,
    rgba(255,255,255,.10) 30%,
    rgba(255,255,255,0) 60%);
  mix-blend-mode:screen;
}

/* Level text (top-right) */
#dailyHero .level{
  position:absolute; top:12px; right:16px;
  font-weight:800; font-size:18px; letter-spacing:.5px;
  z-index:1;
}

/* Chips row pinned bottom-right; vertically aligned to button centreline */
#dailyHero .meta-chips{
  position:absolute; right:16px;
  bottom: calc(var(--btn-bottom) + (var(--btn-h)/2) - (var(--chip-h)/2));
  display:flex; gap:8px; flex-wrap:wrap; margin:0;
  justify-content:flex-end;
}
.chip{
  display:inline-flex; align-items:center; gap:6px;
  height:var(--chip-h); padding:0 12px; border-radius:999px;
  background:rgba(0,0,0,.45); border:1px solid var(--stroke);
  color:var(--ink); font-weight:700; font-size:13px;
}
.chip .k{ opacity:.75; font-weight:700; }
.chip .v{ font-weight:900; }

/* —— Skins (glossy, like polished car paint) —— */
#dailyHero[data-skin="bronze"]{
  background:
    linear-gradient(135deg,#5e3515,#b86b2e 40%,#ffb067 70%,#5e3515 95%);
  color:#fff;
}
#dailyHero[data-skin="silver"]{
  background:
    linear-gradient(135deg,#7c838a,#cfd6dd 35%,#f7f9fa 60%,#7c838a 90%);
  color:#111;
}
#dailyHero[data-skin="gold"]{
  background:
    linear-gradient(135deg,#9c7a00,#d4af37 35%,#ffe680 65%,#9c7a00 95%);
  color:#111;
}
#dailyHero[data-skin="black"]{
  background:
    linear-gradient(135deg,#000,#222 30%,#444 50%,#111 70%,#000 95%);
  color:#fff;
  border-color: rgba(255,255,255,.22);
}

/* Embossed look for Bronze/Silver/Gold */
#dailyHero[data-skin="bronze"] .level,
#dailyHero[data-skin="silver"] .level,
#dailyHero[data-skin="gold"]   .level{
  color:inherit;
  text-shadow: 1px 1px 2px rgba(0,0,0,.6),
               -1px -1px 2px rgba(255,255,255,.3);
}
/* Expert = Gold fill on black */
#dailyHero[data-skin="black"] .level{
  background:linear-gradient(135deg,#ffd54a,#f6c400);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  text-shadow: 1px 1px 3px rgba(0,0,0,.9);
}

/* Small-screen fallback: let chips flow under content */
@media (max-width:540px){
  #dailyHero .meta-chips{
    position:static; margin-top:10px; justify-content:flex-start;
  }
}

/* ===== WEEKLY HERO (single card, week-long) ===== */
#weeklyHero{
  position:relative; color:#eef3ff;
  background:
    linear-gradient(135deg,#0b0d12,#172033 40%,#0b0d12 90%);
}
#weeklyHero .label{
  position:absolute; top:12px; left:16px; font-weight:900; opacity:.95;
}

/* ===== CHALLENGE TRACKER HERO ===== */
#trackerHero .track-wrap{
  display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px; margin-top:8px;
}
.ring{
  display:flex; align-items:center; gap:12px; padding:10px; background:rgba(0,0,0,.28);
  border:1px solid var(--stroke); border-radius:12px;
}
.ring svg{ width:72px; height:72px; display:block }
.ring .meta{ margin:0; }
.ring .meta strong{ display:block; font-size:14px; }
.ring .meta span{ color:var(--ink-dim); font-size:13px }
.dot-row, .tick-row{ display:flex; gap:6px; margin-top:8px; flex-wrap:wrap }
.dot{ width:10px; height:10px; border-radius:50%; background:#2c2c2c; border:1px solid rgba(255,255,255,.15) }
.dot.on{ background:var(--green); border-color:rgba(50,215,75,.6) }
.tick{ width:12px; height:6px; border-radius:3px; background:#2c2c2c; border:1px solid rgba(255,255,255,.15) }
.tick.on{ background:var(--blue); border-color:rgba(10,132,255,.55) }

/* ===== SIMPLE AVATAR DRAWER (drops down under avatar) ===== */
#avatarDrawerMask{
  position:fixed; inset:0; background:transparent; display:none; z-index:59;
}
#avatarDrawerMask.open{ display:block; }
#avatarDrawer{
  position:absolute; top:calc(var(--nav-h) - 4px); right:12px; width:280px;
  background:#0f1116; border:1px solid var(--stroke);
  border-radius:14px; overflow:hidden; box-shadow:0 20px 50px rgba(0,0,0,.6);
  transform-origin: top right; transform: translateY(-10px) scale(.98);
  opacity:0; pointer-events:none; z-index:60;
  transition: opacity .16s ease, transform .16s ease;
}
#avatarDrawer.open{ opacity:1; transform: translateY(0) scale(1); pointer-events:auto; }
#avatarDrawer .menu a{
  display:block; padding:12px 14px; font-weight:800; border-bottom:1px solid rgba(255,255,255,.08);
}
#avatarDrawer .menu a:last-child{ border-bottom:none }
#avatarDrawer .brand{ padding:14px; text-align:left; border-top:1px solid rgba(255,255,255,.08); }
#avatarDrawer .brand .blue{ color:var(--blue); font-weight:900; font-size:16px; line-height:1.1 }
#avatarDrawer .brand .white{ color:#fff; opacity:.95; font-weight:800; font-size:14px; line-height:1.1 }

/* ===== BUY SHEET (no points / redemption) ===== */
.sheet-mask{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:none;z-index:60}
.sheet-mask.open{display:block}
.sheet{position:fixed;left:0;right:0;bottom:-100%;background:#0f1116;border-radius:16px 16px 0 0;
       border:1px solid rgba(255,255,255,.15);padding:14px;z-index:61;transition:transform .2s ease, bottom .2s ease}
.sheet.open{bottom:0}
.sheet h3{margin:0 0 8px;font-size:18px;font-weight:900}
.sheet .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.sheet .meta{color:#cfd3e1}

/* Ensure templates never interfere with layout */
#templates[hidden]{ display:none !important; visibility:hidden !important; }
</style>
</head>
<body>

<div class="bg" aria-hidden="true"></div>

<!-- ===== HEADER (Tabs + Avatar) ===== -->
<header class="nav">
  <div class="nav-left" role="tablist" aria-label="Primary">
    <button class="btn-tab is-active" data-tab="challenges" aria-selected="true">Challenges</button>
    <button class="btn-tab" data-tab="courses" aria-selected="false">Courses</button>
    <button class="btn-tab" data-tab="live" aria-selected="false">Live</button>
  </div>
  <div class="nav-right">
    <button id="avatarTab" class="btn-tab avatarTab" aria-haspopup="dialog" aria-expanded="false">
      <span class="dot" id="avatarInitials">JG</span>
    </button>
  </div>

  <!-- Simple drop-down drawer under avatar -->
  <div id="avatarDrawerMask"></div>
  <div id="avatarDrawer" role="dialog" aria-modal="true" aria-hidden="true">
    <nav class="menu">
      <a href="profile.html">Profile</a>
      <a href="booked.html">Booked Classes</a>
      <a href="tracker.html">Challenge Tracker</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact Us</a>
      <a href="settings.html">Settings</a>
    </nav>
    <div class="brand">
      <div class="blue">Online Art</div>
      <div class="white">by Jody Graham</div>
    </div>
  </div>
</header>

<!-- ===== HOME / MAIN (tabs & panels) ===== -->
<main class="wrap">
  <!-- Challenges -->
  <section id="panel-challenges" data-panel="challenges">
    <!-- DAILY -->
    <article class="hero" id="dailyHero" aria-labelledby="dailyTitle" data-skin="bronze">
      <h2 class="title" id="dailyTitle">Daily Challenge</h2>
      <p class="meta" id="dailyDate">—</p>

      <!-- injected: <div class="level" id="dailyLevel">Beginner</div> -->

      <!-- The snippet from challenges/daily/today.html is injected here -->
      <div id="dailyContent">
        <p class="desc">New prompt coming soon.</p>
        <div class="meta-chips"></div>
      </div>

      <div class="cta-left"><button class="btn blue" id="btnDaily">Complete</button></div>
    </article>

    <!-- WEEKLY (single hero) -->
    <article class="hero" id="weeklyHero" aria-labelledby="weeklyTitle">
      <h2 class="title" id="weeklyTitle">Weekly Challenge</h2>
      <span class="label" id="weeklyLabel">Weekly Challenge</span>
      <p class="meta" id="weeklyMeta">—</p>
      <p class="desc" id="weeklyDesc">Design focus for the week.</p>
      <div class="cta-left">
        <a class="btn blue" id="btnWeeklyStart" href="#" rel="noopener">Start Challenge</a>
      </div>
    </article>

    <!-- TRACKER -->
    <article class="hero" id="trackerHero" aria-labelledby="trackerTitle">
      <h2 class="title" id="trackerTitle">Challenge Tracker</h2>
      <p class="meta">See your recent progress.</p>

      <div class="track-wrap">
        <div>
          <div class="ring" id="ringDaily">
            <!-- SVG ring injected -->
            <p class="meta"><strong>Daily (7d)</strong><span id="dailyPct">0% complete</span></p>
          </div>
          <div class="dot-row" id="dailyDots"></div>
        </div>
        <div>
          <div class="ring" id="ringWeekly">
            <!-- SVG ring injected -->
            <p class="meta"><strong>Weekly (12w)</strong><span id="weeklyPct">0% complete</span></p>
          </div>
          <div class="tick-row" id="weeklyTicks"></div>
        </div>
      </div>
    </article>
  </section>

  <!-- Courses -->
  <section id="panel-courses" class="hide" data-panel="courses">
    <h2 class="section-title">Foundations</h2>
    <div class="weekly-grid" id="foundationsGrid"></div>

    <h2 class="section-title">1-Day Courses</h2>
    <div class="weekly-grid" id="oneDayGrid"></div>

    <h2 class="section-title">3-Day Courses</h2>
    <div class="weekly-grid" id="threeDayGrid"></div>

    <h2 class="section-title">30-Day Courses</h2>
    <div class="weekly-grid" id="thirtyDayGrid"></div>
  </section>

  <!-- Live -->
  <section id="panel-live" class="hide" data-panel="live">
    <h2 class="section-title">Demonstrations</h2>
    <div class="weekly-grid" id="demoGrid"></div>
  </section>
</main>

<!-- ===== TEMPLATES (hidden clones) ===== -->
<div id="templates" hidden>
  <!-- Foundation template -->
  <article class="hero tall course" data-kind="foundation" data-id="__ID__">
    <h3 class="title"><span class="t">__TITLE__</span></h3>
    <p class="meta">Core drills to build accuracy and flow.</p>
    <p class="desc">Replace with course description.</p>
    <div class="cta-left"><a class="btn blue start-found" href="#">Start Course</a></div>
  </article>

  <!-- Paid course template -->
  <article class="hero tall course" data-kind="paid" data-id="__ID__">
    <h3 class="title"><span class="t">__TITLE__</span></h3>
    <p class="meta">Structured, focused learning.</p>
    <p class="desc">Replace with course description.</p>
    <div class="cta-left"><button class="btn green buy">Buy</button></div>
    <div class="price" data-price="$—"><span>$—</span></div>
  </article>

  <!-- Demo placeholder -->
  <article class="hero tall live" data-kind="demo" data-id="demo-coming" style="opacity:.55; filter:saturate(.7)">
    <h3 class="title">Demonstrations (Coming soon)</h3>
    <p class="meta">Live demo sessions will appear here.</p>
    <p class="desc">We’re preparing a series of live demonstrations. Stay tuned.</p>
    <div class="cta-left"><button class="btn grey" disabled>Coming soon</button></div>
  </article>
</div>

<!-- ===== SHEETS (Buy only; no points redeem) ===== -->
<div class="sheet-mask" id="buyMask" aria-hidden="true"></div>
<div class="sheet" id="buySheet" role="dialog" aria-modal="true" aria-labelledby="buyTitle">
  <h3 id="buyTitle">Unlock</h3>
  <p class="meta" id="buyMeta">Proceed to payment to unlock this course.</p>
  <div class="row">
    <button class="btn green" id="buyPay">Proceed to payment</button>
    <button class="btn grey" id="buyCancel">Cancel</button>
  </div>
</div>

<!-- ===== PRICING / REGISTRY (inline fallback) ===== -->
<script id="pricingData" type="application/json">
{
  "1d-gesture":{"price":"$39"},
  "3d-portrait":{"price":"$79"},
  "30d-foundations":{"price":"$149"},
  "live-1":{"price":"$29"}
}
</script>
<script id="registryData" type="application/json">
{
  "foundations": [
    { "id": "found-setup", "slug": "found-setup", "title": "Materials & Setup", "showOnHome": true },
    { "id": "found-drawing", "slug": "found-drawing", "title": "Drawing", "showOnHome": true },
    { "id": "found-painting", "slug": "found-painting", "title": "Painting", "showOnHome": true }
  ],
  "courses": {
    "1day": [
      { "id": "1d-gesture", "slug": "1d-gesture", "title": "1-Day Gesture", "price": "$39", "showOnHome": true }
    ],
    "3day": [
      { "id": "3d-portrait", "slug": "3d-portrait", "title": "3-Day Portrait", "price": "$79", "showOnHome": true }
    ],
    "30day": [
      { "id": "30d-foundations", "slug": "30d-foundations", "title": "30-Day Drawing Habit", "price": "$149", "showOnHome": false }
    ]
  },
  "weekly": [
    { "id": "W1", "title": "Ink Portrait", "expires": "2025-09-14", "desc": "Brush + splash accents.", "showOnHome": true },
    { "id": "W2", "title": "Value Composition", "expires": "2025-09-21", "desc": "Design with 3 clear values.", "showOnHome": false },
    { "id": "W3", "title": "Edges & Atmosphere", "expires": "2025-09-28", "desc": "Depth via soft transitions.", "showOnHome": false }
  ],
  "live": [
    { "id": "live-1", "title": "Saturday Studio", "price": "$29", "starts": "2025-09-20T09:00:00+10:00", "showOnHome": false }
  ],
  "demos": [
    { "id": "demo-coming", "title": "Demonstrations", "comingSoon": true, "showOnHome": true }
  ]
}
</script>

<!-- ===== SCRIPT – STATE, HELPERS, TABS, DAILY/WEEKLY/TRACKER ===== -->
<script>
(()=>{'use strict';
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const pad=n=>String(n).padStart(2,'0');
const toISO=d=>d.toISOString().slice(0,10);
const cap=s=>(s||'').replace(/\b\w/g,m=>m.toUpperCase());

/* ===== Tabs ===== */
const tabBtns=$$('.btn-tab[data-tab]');
const panels=$$('[data-panel]');
tabBtns.forEach(b=>b.addEventListener('click', ()=>{
  tabBtns.forEach(x=>{x.classList.toggle('is-active',x===b); x.setAttribute('aria-selected', x===b?'true':'false');});
  panels.forEach(p=>p.classList.toggle('hide', p.dataset.panel!==b.dataset.tab));
  window.scrollTo({top:0,behavior:'smooth'});
}));

/* ===== Simple Avatar Drawer ===== */
const avatarBtn = $('#avatarTab');
const drawer = $('#avatarDrawer');
const drawerMask = $('#avatarDrawerMask');
function openDrawer(){ drawer.classList.add('open'); drawerMask.classList.add('open'); drawer.setAttribute('aria-hidden','false'); avatarBtn.setAttribute('aria-expanded','true'); }
function closeDrawer(){ drawer.classList.remove('open'); drawerMask.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); avatarBtn.setAttribute('aria-expanded','false'); }
avatarBtn.addEventListener('click', ()=> drawer.classList.contains('open') ? closeDrawer() : openDrawer());
drawerMask.addEventListener('click', closeDrawer);
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && drawer.classList.contains('open')) closeDrawer(); });

/* ===== Daily date + complete toggle (no points) ===== */
const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const today=new Date(), isoToday=toISO(today);
$('#dailyDate').textContent = `${dayNames[today.getDay()]} ${pad(today.getDate())}/${pad(today.getMonth()+1)}`;

let dailyDone = JSON.parse(localStorage.getItem('ao_daily_done')||'[]');
function paintDaily(){
  const done = dailyDone.includes(isoToday);
  $('#btnDaily').textContent = done?'Undo':'Complete';
  $('#btnDaily').className = 'btn ' + (done?'grey':'blue');
  $('#dailyHero').classList.toggle('complete', done);
}
paintDaily();
$('#btnDaily').addEventListener('click', ()=>{
  const idx=dailyDone.indexOf(isoToday);
  if(idx===-1){ dailyDone.push(isoToday); }
  else{ dailyDone.splice(idx,1); }
  localStorage.setItem('ao_daily_done', JSON.stringify(dailyDone));
  paintDaily(); paintTracker(); // update tracker live
});

/* ===== Daily loader (HTML include) + skin & level injection ===== */
async function loadDailyFromHTML(){
  const target = document.getElementById('dailyContent');
  try{
    const res = await fetch('./challenges/daily/today.html', { cache:'no-store' });
    if(!res.ok) throw new Error('today.html not found');
    target.innerHTML = await res.text();
  }catch(err){
    console.warn('[Daily] Could not load challenges/daily/today.html', err);
    target.innerHTML = `<p class="desc">New prompt coming soon.</p><div class="meta-chips"></div>`;
  }
}
function applyDailySkinAndLevel(){
  const host = document.getElementById('dailyHero');
  const chips = Array.from(document.querySelectorAll('#dailyContent .chip'));
  let lvl = '';
  chips.forEach(ch=>{
    const k = (ch.querySelector('.k')?.textContent || '').toLowerCase();
    if (k.includes('level')) {
      lvl = (ch.querySelector('.v')?.textContent || '').trim().toLowerCase();
      ch.remove(); // remove from chips
    }
  });
  const map = { beginner:'bronze', intermediate:'silver', advanced:'gold', expert:'black' };
  const skin = map[lvl] || 'bronze';
  host.setAttribute('data-skin', skin);

  const label = lvl ? cap(lvl) : 'Beginner';
  let el = document.getElementById('dailyLevel');
  if(!el){ el = document.createElement('div'); el.id='dailyLevel'; el.className='level'; host.appendChild(el); }
  el.textContent = label;
}

/* ===== Weekly single hero ===== */
let weeklyLog = JSON.parse(localStorage.getItem('ao_weekly_log')||'[]'); // array of ISO dates when weekly completed
function setWeeklyHero(item){
  const meta = $('#weeklyMeta');
  const desc = $('#weeklyDesc');
  const start = new Date(); // today as reference
  const ends = item?.expires ? new Date(item.expires) : null;
  meta.textContent = ends ? `Ends Sun ${pad(ends.getDate())}/${pad(ends.getMonth()+1)}` : 'Available this week';
  desc.textContent = item?.desc || 'Design focus for the week.';
  const link = `challenges/weekly-${item.id}.html`;
  $('#btnWeeklyStart').setAttribute('href', link);
  $('#btnWeeklyStart').dataset.weekId = item.id;
}
function markWeeklyComplete(){
  const iso = toISO(new Date());
  if(!weeklyLog.includes(iso)){
    weeklyLog.push(iso);
    localStorage.setItem('ao_weekly_log', JSON.stringify(weeklyLog));
    paintTracker();
  }
}
window.AO_markWeeklyComplete = markWeeklyComplete; // in case weekly pages call it

/* ===== Tracker ===== */
function ringSVG(percent, color){
  const p = Math.max(0,Math.min(100,percent));
  const r=30, c=2*Math.PI*r, dash = (p/100)*c;
  return `
    <svg viewBox="0 0 80 80" aria-hidden="true">
      <circle cx="40" cy="40" r="${r}" fill="none" stroke="rgba(255,255,255,.12)" stroke-width="8"/>
      <circle cx="40" cy="40" r="${r}" fill="none" stroke="${color}" stroke-width="8"
              stroke-linecap="round" stroke-dasharray="${dash} ${c-dash}" transform="rotate(-90 40 40)"/>
    </svg>`;
}
function getLast7Days(){
  const days=[]; const now=new Date();
  for(let i=6;i>=0;i--){ const d=new Date(now); d.setDate(now.getDate()-i); days.push(toISO(d)); }
  return days;
}
function weekKey(dt){
  const d=new Date(dt); // ISO string OK
  const tmp=new Date(d); const day=tmp.getDay(); // 0..6 Sun..Sat
  const monday=new Date(tmp); monday.setDate(tmp.getDate() - ((day+6)%7)); monday.setHours(0,0,0,0);
  return toISO(monday); // week id = ISO of Monday
}
function getLastNWeekKeys(n=12){
  const keys=[]; const now=new Date(); // start from current week
  const curMon = new Date(now); curMon.setDate(now.getDate()-((now.getDay()+6)%7)); curMon.setHours(0,0,0,0);
  for(let i=n-1;i>=0;i--){ const d=new Date(curMon); d.setDate(curMon.getDate() - i*7); keys.push(toISO(d)); }
  return keys;
}
function paintTracker(){
  // Daily 7d
  const last7 = getLast7Days();
  const doneSet = new Set(dailyDone);
  const hits = last7.filter(d=>doneSet.has(d)).length;
  const pct = Math.round((hits/7)*100);
  $('#dailyPct').textContent = `${pct}% complete`;
  $('#ringDaily').querySelector('svg')?.remove();
  $('#ringDaily').insertAdjacentHTML('afterbegin', ringSVG(pct, 'var(--green)'));
  const dots = $('#dailyDots'); dots.innerHTML='';
  last7.forEach(d=>{
    const dot=document.createElement('div'); dot.className='dot' + (doneSet.has(d)?' on':''); dots.appendChild(dot);
  });

  // Weekly 12w (~3 months)
  const last12 = getLastNWeekKeys(12);
  const logWeeks = new Set(weeklyLog.map(iso=>weekKey(iso)));
  const wHits = last12.filter(k=>logWeeks.has(k)).length;
  const wPct = Math.round((wHits/12)*100);
  $('#weeklyPct').textContent = `${wPct}% complete`;
  $('#ringWeekly').querySelector('svg')?.remove();
  $('#ringWeekly').insertAdjacentHTML('afterbegin', ringSVG(wPct, 'var(--blue)'));
  const ticks = $('#weeklyTicks'); ticks.innerHTML='';
  last12.forEach(k=>{
    const t=document.createElement('div'); t.className='tick' + (logWeeks.has(k)?' on':''); ticks.appendChild(t);
  });
}

/* ===== Pricing/Registry (fallback) + initial paint ===== */
function readPricing(){
  try{ return JSON.parse(document.getElementById('pricingData').textContent||'{}'); }catch{return{}}
}
let pricing = readPricing();

async function loadRegistry(){
  try{
    const res = await fetch('./data/registry.json', {cache:'no-store'});
    if(!res.ok) throw new Error('no registry');
    return await res.json();
  }catch{
    try{ return JSON.parse(document.getElementById('registryData').textContent||'{}'); }
    catch{ return {}; }
  }
}
function cloneTemplate(selector){ return document.querySelector(selector).cloneNode(true); }
function applyPrice(card, price){
  const priceEl = card.querySelector('.price'); if(priceEl && price){ priceEl.dataset.price = price; priceEl.firstElementChild.textContent = price; }
}
function renderFromRegistry(reg){
  // foundations/courses/demos (unchanged)
  const fGrid = document.getElementById('foundationsGrid'); fGrid.innerHTML='';
  (reg.foundations||[]).filter(x=>x.showOnHome!==false).forEach(item=>{
    const t = cloneTemplate('#templates > article[data-kind="foundation"]');
    t.dataset.id = item.id; t.querySelector('.t').textContent = item.title;
    t.dataset.link = `courses/${item.slug||item.id}.html`;
    fGrid.appendChild(t);
  });
  const one = document.getElementById('oneDayGrid'); one.innerHTML='';
  (reg.courses?.["1day"]||[]).filter(x=>x.showOnHome!==false).forEach(item=>{
    const t = cloneTemplate('#templates > article[data-kind="paid"]');
    t.dataset.id = item.id; t.querySelector('.t').textContent = item.title;
    t.dataset.link = `courses/${item.slug||item.id}.html`; applyPrice(t, item.price); one.appendChild(t);
  });
  const three = document.getElementById('threeDayGrid'); three.innerHTML='';
  (reg.courses?.["3day"]||[]).filter(x=>x.showOnHome!==false).forEach(item=>{
    const t = cloneTemplate('#templates > article[data-kind="paid"]');
    t.dataset.id = item.id; t.querySelector('.t').textContent = item.title;
    t.dataset.link = `courses/${item.slug||item.id}.html`; applyPrice(t, item.price); three.appendChild(t);
  });
  const thirty = document.getElementById('thirtyDayGrid'); thirty.innerHTML='';
  (reg.courses?.["30day"]||[]).filter(x=>x.showOnHome!==false).forEach(item=>{
    const t = cloneTemplate('#templates > article[data-kind="paid"]');
    t.dataset.id = item.id; t.querySelector('.t').textContent = item.title;
    t.dataset.link = `courses/${item.slug||item.id}.html`; applyPrice(t, item.price); thirty.appendChild(t);
  });

  // Single weekly hero: choose first showOnHome
  const show = (reg.weekly||[]).find(x=>x.showOnHome!==false);
  if(show){ setWeeklyHero(show); }
}

(async()=>{
  await loadDailyFromHTML();
  applyDailySkinAndLevel();

  const reg = await loadRegistry();
  renderFromRegistry(reg);

  // initial tracker paint
  paintTracker();
})();
})();
</script>

<!-- Safety badge for debugging in prod -->
<script>
  window.onerror = function (msg, src, line, col) {
    const b = document.createElement('div');
    b.style.cssText = 'position:fixed;left:8px;bottom:8px;z-index:99999;background:#300;padding:8px 10px;border:1px solid #a00;border-radius:6px;color:#fff;font:12px/1.3 system-ui';
    b.textContent = 'JS error: ' + msg + ' @ ' + (src||'inline') + ':' + line + ':' + col;
    document.body.appendChild(b);
    console.error('[FAOA] JS error', msg, src, line, col);
  };
  console.log('[FAOA] boot check OK');
</script>
</body>
</html>