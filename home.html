<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>Home — FAOA</title>

<style>
:root{
  --ink:#eef3ff; --ink-dim:#cfd3e1; --muted:rgba(238,243,255,.78);
  --bg:#000; --stroke:rgba(255,255,255,.18);
  --blue:#0A84FF; --green:#32d74b; --gold:#ffd700; --silver:#c0c7d1; --bronze:#b87333; --red:#ff453a; --black:#111;
  --gap:12px; --r:14px; --maxw:1240px; --nav-h:68px; --btn-h:44px; --btn-bottom:14px;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; background:var(--bg); color:var(--ink);
  font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif;
  overscroll-behavior:contain}
a{color:inherit;text-decoration:none}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

/* Background */
.bg{position:fixed;inset:0;z-index:-1;background:#000 url("./assets/home-bg.jpg") center/cover no-repeat}

/* ===== FIXED TOP BAR ===== */
.nav{
  position:fixed; top:0; left:0; right:0; height:var(--nav-h);
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:8px 12px; z-index:40;
  background:linear-gradient(180deg, rgba(0,0,0,.9), rgba(0,0,0,.55) 60%, rgba(0,0,0,.3));
  -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px);
}
.nav-left{display:flex; gap:8px; align-items:center}
.btn-tab{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:104px; height:44px; padding:0 14px;
  border-radius:12px; border:1px solid var(--stroke);
  background:rgba(0,0,0,.55); color:var(--ink); font-weight:900; cursor:pointer;
  transition:transform .06s ease, filter .15s ease; font-size:15px;
}
.btn-tab:active{transform:translateY(1px)}
.btn-tab.is-active{background:var(--blue); border-color:transparent; color:#000}

/* Avatar pill (no photo; solid colour by role) */
.avatarTab{
  display:flex; flex-direction:column; align-items:flex-start; justify-content:center;
  padding:6px 12px; border-radius:12px; min-width:132px; height:44px;
  font-weight:900; line-height:1.1; text-align:left; cursor:pointer;
  border:1px solid var(--stroke); background:#222;
}
.avatarTab .name{font-size:15px; font-weight:900}
.avatarTab .lvl{font-size:12px; opacity:.95; text-transform:capitalize}

/* Content wrap (safe area for fixed header) */
.wrap{max-width:var(--maxw); margin:0 auto; padding:calc(var(--nav-h) + env(safe-area-inset-top) + 10px) 14px 120px}

/* ===== HERO ===== */
.hero{position:relative; overflow:hidden; background:#060708;
  border:1px solid var(--stroke); border-radius:16px; padding:16px; margin:12px 0}
.hero .title{margin:0 0 6px; font-weight:900; font-size:20px; display:flex; align-items:center; gap:8px}
.hero .meta{margin:0 0 6px; color:var(--ink-dim)}
.hero .desc{margin:8px 0 56px; color:var(--muted)}
.cta-left{position:absolute; left:16px; bottom:var(--btn-bottom); display:flex; gap:10px}
.btn{display:inline-flex; align-items:center; justify-content:center; min-width:130px; height:var(--btn-h); padding:0 16px; border-radius:12px; border:1px solid var(--stroke); font-weight:900; background:#0f1116; color:var(--ink); cursor:pointer}
.btn.blue{background:var(--blue); border-color:transparent; color:#000}
.btn.grey{background:#3a3a3a; color:#fff}
.badge{display:inline-flex; align-items:center; height:28px; padding:0 10px; border-radius:999px; border:1px solid var(--stroke); font-weight:900; font-size:12px}

/* Daily skin gloss */
#dailyHero[data-skin="bronze"]{ background:linear-gradient(135deg,#5e3515,#b86b2e 40%,#ffb067 70%,#5e3515 95%); color:#fff }
#dailyHero[data-skin="silver"]{ background:linear-gradient(135deg,#7c838a,#cfd6dd 35%,#f7f9fa 60%,#7c838a 90%); color:#111 }
#dailyHero[data-skin="gold"]{ background:linear-gradient(135deg,#9c7a00,#d4af37 35%,#ffe680 65%,#9c7a00 95%); color:#111 }
#dailyHero[data-skin="black"]{ background:linear-gradient(135deg,#000,#222 30%,#444 50%,#111 70%,#000 95%); color:#fff; border-color:rgba(255,255,255,.22) }
#dailyHero .level{ position:absolute; top:12px; right:16px; font-weight:800; font-size:18px }

/* ===== TRACKER (Daily only) ===== */
.tracker{cursor:pointer}
.tracker .cards{display:grid; grid-template-columns:1fr; gap:var(--gap)}
.tracker .card{border:1px solid var(--stroke); border-radius:12px; padding:12px; background:rgba(255,255,255,.03)}
.tracker .kpi{display:flex; align-items:center; gap:8px; color:var(--ink-dim); font-weight:700}
.medals{display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap; margin-top:10px}
.medal{width:30px; height:30px; border-radius:50%; border:2px solid rgba(255,255,255,.22); background:transparent}

/* PANELS */
[data-panel]{display:none}
[data-panel].panel-active{display:block}

/* Avatar Drawer */
#avatarSheet{position:fixed; inset:0; z-index:60; display:none; background:rgba(0,0,0,.45); -webkit-backdrop-filter:blur(4px); backdrop-filter:blur(4px)}
#avatarSheet.open{display:block}
#avatarSheet .panel{position:absolute; top:calc(var(--nav-h) + 6px); right:12px; width:320px; max-height:70vh; overflow:auto; background:#0f1116; border:1px solid var(--stroke); border-radius:14px; padding:12px}
.menu a{display:flex; align-items:center; justify-content:space-between; padding:12px 10px; border-bottom:1px solid rgba(255,255,255,.08)}
.menu a:last-child{border-bottom:none}

/* Subsheet (iframe) */
#subSheet{position:fixed; inset:0; z-index:70; display:none; background:rgba(0,0,0,.55); -webkit-backdrop-filter:blur(6px); backdrop-filter:blur(6px)}
#subSheet.open{display:block}
#subSheet .inner{position:absolute; top:calc(var(--nav-h) + 6px); right:12px; width:min(820px,calc(100% - 24px)); height:min(78vh,calc(100% - (var(--nav-h) + 24px))); background:#0f1116; border:1px solid var(--stroke); border-radius:14px; padding:12px; display:flex; flex-direction:column}
.sheet-head{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:4px 4px 10px}
.sheet-head h2{margin:0; font-size:22px; font-weight:900}
.sheet-close{width:36px; height:36px; border-radius:10px; border:1px solid var(--stroke); background:#121212; color:#fff; font-weight:900; cursor:pointer}
#subFrame{flex:1 1 auto; width:100%; height:100%; border:none; border-radius:12px; background:#0b0c10}

/* ===== Config pencil ===== */
.cfg-pin{display:none; position:absolute; top:10px; left:10px; width:24px; height:24px; border-radius:8px; background:#111; border:1px solid var(--stroke); font-size:14px; font-weight:900; color:#fff; align-items:center; justify-content:center}
.config-on .cfg-pin{display:flex}

/* ===== Admin footer (working drawer) ===== */
#adminOpen{position:fixed; left:0; right:0; bottom:0; height:42px; display:none; align-items:center; justify-content:center; z-index:45}
#adminOpen button{background:var(--red); color:#fff; border:0; border-top-left-radius:12px; border-top-right-radius:12px; padding:10px 16px; font-weight:900}
#adminDock{position:fixed; left:0; right:0; bottom:0; height:78vh; transform:translateY(100%); transition:transform .18s ease; z-index:80; background:#120c0c; border-top:2px solid var(--red); border-top-left-radius:14px; border-top-right-radius:14px; display:flex; flex-direction:column}
#adminDock.open{transform:translateY(0)}
#adminDock header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; font-weight:900; color:#fff; background:#1a0e0e}
#adminDock .lists{flex:1 1 auto; overflow:auto; padding:10px 12px; display:grid; gap:16px; grid-template-columns:1fr}
.admin-bin{border:1px solid rgba(255,255,255,.14); border-radius:12px; padding:10px}
.admin-bin h3{margin:0 0 8px; font-size:15px}
.bin-item{display:flex; align-items:center; justify-content:space-between; padding:10px 8px; border-radius:10px; background:#0d0d0f; margin:6px 0; border:1px solid var(--stroke)}
.bin-item .s{font-size:12px; opacity:.85}
.chk{display:flex; align-items:center; gap:8px}
.chk input{width:16px; height:16px}
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>

<header class="nav" role="navigation" aria-label="Primary">
  <div class="nav-left" role="tablist" aria-label="Sections">
    <button class="btn-tab is-active" data-tab="feed" aria-selected="true">Feed</button>
    <button class="btn-tab" data-tab="challenges" aria-selected="false">Challenges</button>
    <button class="btn-tab" data-tab="courses" aria-selected="false">Courses</button>
    <button class="btn-tab" data-tab="live" aria-selected="false">Live</button>
  </div>
  <div class="nav-right">
    <button id="avatarTab" class="avatarTab" aria-haspopup="dialog" aria-expanded="false">
      <span class="name" id="avatarName">User</span>
      <span class="lvl" id="avatarLvl">Admin</span>
    </button>
  </div>
</header>

<main class="wrap">
  <!-- ===== FEED ===== -->
  <section id="panel-feed" class="panel-active" data-panel="feed">
    <article class="hero"><button class="cfg-pin" data-cfg="feed-title-1">✎</button>
      <h2 class="title" data-cfg-target="feed-title-1">Placeholder news-hero1</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="feed-title-2">✎</button>
      <h2 class="title" data-cfg-target="feed-title-2">Placeholder news-hero2</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="feed-title-3">✎</button>
      <h2 class="title" data-cfg-target="feed-title-3">Placeholder news-hero3</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="feed-title-4">✎</button>
      <h2 class="title" data-cfg-target="feed-title-4">Placeholder news-hero4</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="feed-title-5">✎</button>
      <h2 class="title" data-cfg-target="feed-title-5">Placeholder news-hero5</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
  </section>

  <!-- ===== CHALLENGES ===== -->
  <section id="panel-challenges" data-panel="challenges">
    <!-- Tracker (daily only) -->
    <article class="hero tracker" id="trackerHero" aria-labelledby="trackerTitle">
      <button class="cfg-pin" data-cfg="tracker-title">✎</button>
      <h2 class="title" id="trackerTitle" data-cfg-target="tracker-title">Challenge Tracker</h2>
      <p class="meta">Daily 7d</p>
      <div class="cards">
        <div class="card">
          <div class="kpi">Daily 7d</div>
          <div class="medals" id="dailyMedals"></div>
        </div>
      </div>
    </article>

    <!-- Daily Hero -->
    <article class="hero" id="dailyHero" data-skin="bronze" aria-labelledby="dailyTitle">
      <button class="cfg-pin" data-cfg="daily-title">✎</button>
      <h2 class="title" id="dailyTitle" data-cfg-target="daily-title">Daily Challenge</h2>
      <p class="meta" id="dailyMeta">Begins today</p>
      <p class="desc">A focused prompt matched to your level. Finish it to earn your streak.</p>
      <div class="cta-left">
        <button class="btn blue" id="btnDailyStart">Start</button>
        <button class="btn grey" id="btnDailyComplete">Complete</button>
      </div>
      <div class="level" id="dailyLevel">Beginner</div>
    </article>

    <!-- Four more placeholder heroes (admin can hide/release later) -->
    <article class="hero"><button class="cfg-pin" data-cfg="ch-2">✎</button>
      <h2 class="title" data-cfg-target="ch-2">Placeholder challenge-hero2</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="ch-3">✎</button>
      <h2 class="title" data-cfg-target="ch-3">Placeholder challenge-hero3</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="ch-4">✎</button>
      <h2 class="title" data-cfg-target="ch-4">Placeholder challenge-hero4</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="ch-5">✎</button>
      <h2 class="title" data-cfg-target="ch-5">Placeholder challenge-hero5</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
  </section>

  <!-- ===== COURSES ===== -->
  <section id="panel-courses" data-panel="courses">
    <article class="hero"><button class="cfg-pin" data-cfg="cr-1">✎</button>
      <h2 class="title" data-cfg-target="cr-1">Placeholder course-hero1</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="cr-2">✎</button>
      <h2 class="title" data-cfg-target="cr-2">Placeholder course-hero2</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="cr-3">✎</button>
      <h2 class="title" data-cfg-target="cr-3">Placeholder course-hero3</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="cr-4">✎</button>
      <h2 class="title" data-cfg-target="cr-4">Placeholder course-hero4</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="cr-5">✎</button>
      <h2 class="title" data-cfg-target="cr-5">Placeholder course-hero5</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
  </section>

  <!-- ===== LIVE ===== -->
  <section id="panel-live" data-panel="live">
    <article class="hero"><button class="cfg-pin" data-cfg="lv-1">✎</button>
      <h2 class="title" data-cfg-target="lv-1">Placeholder live-hero1</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="lv-2">✎</button>
      <h2 class="title" data-cfg-target="lv-2">Placeholder live-hero2</h2>
      <p class="meta">Coming Soon</p><p class="desc">Coming Soon</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="lv-3">✎</button>
      <h2 class="title" data-cfg-target="lv-3">Placeholder live-hero3</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="lv-4">✎</button>
      <h2 class="title" data-cfg-target="lv-4">Placeholder live-hero4</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
    <article class="hero"><button class="cfg-pin" data-cfg="lv-5">✎</button>
      <h2 class="title" data-cfg-target="lv-5">Placeholder live-hero5</h2>
      <p class="meta">Coming Soon</p><p class="desc">—</p></article>
  </section>
</main>

<!-- ===== AVATAR DRAWER ===== -->
<div id="avatarSheet" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="panel" role="document">
    <nav class="menu">
      <a href="avatar/profile.html" data-pop="Profile">Profile<span>›</span></a>
      <a href="avatar/settings.html" data-pop="Settings">Settings<span>›</span></a>
      <a href="avatar/mydata.html" data-pop="My Data">My Data<span>›</span></a>
      <a href="avatar/challengetracker.html" data-pop="Challenge Tracker">Challenge Tracker<span>›</span></a>
      <a href="#" id="cfgToggle">Config Mode<span>⌁</span></a>
    </nav>
  </div>
</div>

<!-- ===== SUB SHEET ===== -->
<div id="subSheet" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="inner" role="document">
    <div class="sheet-head">
      <h2 id="sheetTitle">—</h2>
      <button class="sheet-close" id="sheetClose" aria-label="Close">×</button>
    </div>
    <iframe id="subFrame" title="Panel"></iframe>
  </div>
</div>

<!-- ===== ADMIN FOOTER ===== -->
<div id="adminOpen"><button type="button" id="openDockBtn">Working Drawer</button></div>
<div id="adminDock" aria-hidden="true">
  <header>
    <div>Admin: Hidden / Under Development / Set to Expire</div>
    <button class="sheet-close" id="dockClose" aria-label="Close">×</button>
  </header>
  <div class="lists" id="dockLists">
    <!-- bins are injected per-tab -->
  </div>
</div>

<script>
(()=>{'use strict';
/* =========================
   Utilities & Storage
========================= */
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const store={get:(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}},
             set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};

const K={ profile:'ao_profile', settings:'ao_settings', dailyDone:'ao_daily_done', dailyMeta:'ao_daily_meta' };

/* =========================
   Roles & Partitions
========================= */
const ROLE_PERMS={
  bronze:{ canSeeAdmin:false, canConfig:false, canHideHeroes:false, canManageTabs:false },
  silver:{ canSeeAdmin:false, canConfig:false, canHideHeroes:false, canManageTabs:false },
  gold:{   canSeeAdmin:false, canConfig:false, canHideHeroes:false, canManageTabs:false },
  support:{canSeeAdmin:true,  canConfig:false, canHideHeroes:false, canManageTabs:false },
  director:{canSeeAdmin:true, canConfig:false, canHideHeroes:true,  canManageTabs:false },
  admin:{  canSeeAdmin:true, canConfig:true,  canHideHeroes:true,  canManageTabs:true }
};
const ROLE_SKINS={
  bronze:{pill:'var(--bronze)', text:'#111', daily:'bronze'},
  silver:{pill:'var(--silver)', text:'#0b0c10', daily:'silver'},
  gold:{pill:'var(--gold)', text:'#0b0c10', daily:'gold'},
  support:{pill:'#6a4cff', text:'#fff', daily:'black'},
  director:{pill:'#444', text:'#fff', daily:'black'},
  admin:{pill:'var(--blue)', text:'#0b0c10', daily:'black'}
};
// TEMP: force admin while building; later load from profile storage
function currentRole(){ return 'admin'; }

/* =========================
   Avatar & Level Paint
========================= */
function applyProfile(){
  const p=store.get(K.profile,{displayName:'User',skill:currentRole()});
  const role=(p.skill||currentRole()).toLowerCase();
  const skin=ROLE_SKINS[role]||ROLE_SKINS.silver;

  $('#avatarName').textContent=p.displayName||'User';
  $('#avatarLvl').textContent=role.charAt(0).toUpperCase()+role.slice(1);

  const pill=$('#avatarTab'); pill.style.background=skin.pill; pill.style.color=skin.text;

  // Daily hero gloss by role
  $('#dailyHero').setAttribute('data-skin', skin.daily);
  $('#dailyLevel').textContent = (role==='bronze'?'Beginner':role==='silver'?'Intermediate':role==='gold'?'Advanced':'Advanced');

  // Admin footer visibility
  const perms=ROLE_PERMS[role]||ROLE_PERMS.silver;
  $('#adminOpen').style.display = perms.canSeeAdmin ? 'flex' : 'none';
}
applyProfile();

/* =========================
   Tabs
========================= */
const tabBtns=$$('.btn-tab[data-tab]'); const panels=$$('[data-panel]');
function showTab(name){
  tabBtns.forEach(b=>{ const on=b.dataset.tab===name; b.classList.toggle('is-active',on); b.setAttribute('aria-selected',on?'true':'false'); });
  panels.forEach(p=>p.classList.toggle('panel-active', p.dataset.panel===name));
  window.scrollTo({top:0,behavior:'smooth'});
}
tabBtns.forEach(b=>b.addEventListener('click',()=>showTab(b.dataset.tab)));
showTab('feed');

/* =========================
   Drawer & Subsheet
========================= */
const avatarBtn=$('#avatarTab'), avatarSheet=$('#avatarSheet');
function openDrawer(){ avatarSheet.classList.add('open'); avatarSheet.setAttribute('aria-hidden','false'); avatarBtn.setAttribute('aria-expanded','true'); }
function closeDrawer(){ avatarSheet.classList.remove('open'); avatarSheet.setAttribute('aria-hidden','true'); avatarBtn.setAttribute('aria-expanded','false'); }
avatarBtn.addEventListener('click', openDrawer);
avatarSheet.addEventListener('click', e=>{ if(e.target===avatarSheet) closeDrawer(); });

const subSheet=$('#subSheet'), subFrame=$('#subFrame'), sheetTitle=$('#sheetTitle');
function openSubSheet(title,url){
  sheetTitle.textContent=title;
  subFrame.src=url+(url.includes('?')?'&':'?')+'v='+Date.now();
  subSheet.classList.add('open'); subSheet.setAttribute('aria-hidden','false');
}
function closeSubSheet(){
  subSheet.classList.remove('open'); subSheet.setAttribute('aria-hidden','true');
  subFrame.src='about:blank';
  // re-apply in case profile/settings changed
  applyProfile(); applySettings(); applyHeroVisibility();
}
$('#sheetClose').addEventListener('click', closeSubSheet);
subSheet.addEventListener('click', e=>{ if(e.target===subSheet) closeSubSheet(); });
$$('#avatarSheet [data-pop]').forEach(a=>{
  a.addEventListener('click',e=>{
    e.preventDefault(); closeDrawer(); openSubSheet(a.dataset.pop, a.getAttribute('href'));
  });
});

/* Config Mode toggle (adds .config-on to <body>) */
$('#cfgToggle').addEventListener('click', (e)=>{
  e.preventDefault();
  document.body.classList.toggle('config-on');
  closeDrawer();
});

/* =========================
   Settings + Hero Visibility
========================= */
function defaultSettings(){
  return {
    tabs:{ feed:true, challenges:true, courses:true, live:true },
    heroes:{
      feed:{hidden:false, dev:[], hiddenList:[], expireList:[]},
      challenges:{hidden:false, dev:[], hiddenList:[], expireList:[]},
      courses:{hidden:false, dev:[], hiddenList:[], expireList:[]},
      live:{hidden:false, dev:[], hiddenList:[], expireList:[]}
    },
    heroFlags:{} // per-hero id → {status:'active'|'hidden'|'dev'|'expire', releaseDate?, expiryDate?}
  };
}
function getSettings(){
  const cur=store.get(K.settings,null);
  if(!cur){ const def=defaultSettings(); store.set(K.settings,def); return def; }
  const def=defaultSettings();
  // shallow merge
  return { ...def, ...cur, tabs:{...def.tabs, ...(cur.tabs||{})}, heroes:{...def.heroes, ...(cur.heroes||{})}, heroFlags:{...(cur.heroFlags||{})} };
}
function applySettings(){
  const s=getSettings();
  const setHidden=(name,hide)=>{
    const btn=document.querySelector(`.btn-tab[data-tab="${name}"]`);
    const pnl=document.querySelector(`[data-panel="${name}"]`);
    if(btn) btn.style.display = hide?'none':'inline-flex';
    if(pnl) pnl.style.display = hide?'none':'';
  };
  setHidden('feed', !s.tabs.feed);
  setHidden('challenges', !s.tabs.challenges);
  setHidden('courses', !s.tabs.courses);
  setHidden('live', !s.tabs.live);

  // ensure active tab is visible
  const active=document.querySelector('.btn-tab.is-active');
  if(!active || active.style.display==='none'){
    const first=Array.from(document.querySelectorAll('.btn-tab')).find(b=>b.style.display!=='none');
    if(first) showTab(first.dataset.tab);
  }
}
applySettings();

function applyHeroVisibility(){
  const flags=getSettings().heroFlags||{};
  // iterate all heroes and hide based on status
  $$('section [data-hero-id]').forEach(el=>{
    const id=el.getAttribute('data-hero-id');
    const st=(flags[id]||{}).status||'active';
    el.style.display = (st==='active') ? '' : 'none';
  });
  paintAdminBins();
}

/* Give IDs to each hero for flags */
(function tagHeroes(){
  let n=0;
  $$('section .hero').forEach(el=>{
    if(!el.id || !el.dataset.heroId){
      el.dataset.heroId = (el.closest('[data-panel]')?.dataset.panel||'home') + '-hero' + (++n);
    }
  });
})();

/* =========================
   Admin Dock (footer)
========================= */
const openDockBtn=$('#openDockBtn'), adminDock=$('#adminDock'), dockClose=$('#dockClose');
openDockBtn.addEventListener('click', ()=> adminDock.classList.add('open'));
dockClose.addEventListener('click', ()=> adminDock.classList.remove('open'));
function paintAdminBins(){
  const role=currentRole(); const perms=ROLE_PERMS[role]||ROLE_PERMS.silver;
  if(!perms.canSeeAdmin) return;

  const flags=getSettings().heroFlags||{};
  const binsByTab = { feed:[], challenges:[], courses:[], live:[] };

  $$('section .hero').forEach(el=>{
    const id=el.dataset.heroId;
    const st=(flags[id]?.status)||'active';
    if(st==='active') return;
    const tab=el.closest('[data-panel]').dataset.panel;
    binsByTab[tab].push({id, title:el.querySelector('.title')?.textContent?.trim()||id, status:st});
  });

  const lists=$('#dockLists'); lists.innerHTML='';
  Object.entries(binsByTab).forEach(([tab,items])=>{
    const bin=document.createElement('div'); bin.className='admin-bin';
    bin.innerHTML=`<h3>${tab.toUpperCase()}</h3>`;
    if(!items.length){ bin.innerHTML+=`<div class="s">No items</div>`; }
    items.forEach(it=>{
      const row=document.createElement('div'); row.className='bin-item';
      row.innerHTML=`<div><div>${it.title}</div><div class="s">${it.id} • ${it.status}</div></div>
        <div class="chk">
          <label class="s"><input type="radio" name="st-${it.id}" value="active"> Active</label>
          <label class="s"><input type="radio" name="st-${it.id}" value="hidden"> Hidden</label>
          <label class="s"><input type="radio" name="st-${it.id}" value="dev"> Dev</label>
          <label class="s"><input type="radio" name="st-${it.id}" value="expire"> Expire</label>
        </div>`;
      // preset
      row.querySelectorAll(`input[name="st-${it.id}"]`).forEach(r=>{
        r.checked=(r.value===it.status);
        r.addEventListener('change', ()=>{
          const s=getSettings();
          s.heroFlags[it.id]={...(s.heroFlags[it.id]||{}), status:r.value};
          store.set(K.settings,s);
          applyHeroVisibility();
        });
      });
      bin.appendChild(row);
    });
    lists.appendChild(bin);
  });
}

/* show red footer if admin/support/director allowed to see admin */
(function initFooter(){
  const role=currentRole(); const perms=ROLE_PERMS[role]||ROLE_PERMS.silver;
  $('#adminOpen').style.display = perms.canSeeAdmin ? 'flex' : 'none';
  paintAdminBins();
})();

/* =========================
   Daily tracker stub
========================= */
(function paintEmpty(){
  const dm=$('#dailyMedals'); if(!dm) return;
  dm.innerHTML='';
  for(let i=0;i<7;i++){ const m=document.createElement('div'); m.className='medal'; dm.appendChild(m); }
})();

/* Pretty daily meta */
(function bootDailyMeta(){
  const today=new Date(); const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  $('#dailyMeta').textContent = `Begins ${dayNames[today.getDay()]}`;
})();

/* Tracker hero click -> iframe */
$('#trackerHero').addEventListener('click',()=>openSubSheet('Challenge Tracker','avatar/challengetracker.html'));

/* Storage sync from other pages */
window.addEventListener('storage',e=>{
  if(e.key===K.profile){ applyProfile(); }
  if(e.key===K.settings){ applySettings(); applyHeroVisibility(); }
});

/* Initial hero visibility pass */
applyHeroVisibility();

/* In-place config title editing (pencil) */
document.body.addEventListener('click', (e)=>{
  const pin=e.target.closest('.cfg-pin'); if(!pin) return;
  const id=pin.dataset.cfg; const tgt=document.querySelector(`[data-cfg-target="${id}"]`);
  if(!tgt) return;
  const cur=tgt.textContent.trim();
  const next=prompt('Edit title', cur);
  if(next!=null){ tgt.textContent=next; }
});

})();
</script>
</body>
</html>