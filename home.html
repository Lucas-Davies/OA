<!DOCTYPE html>
<html lang="en-AU">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<title>Home ‚Äî FAOA</title>

<!-- Google fonts for rename dialog (optional) -->
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Raleway:wght@700;900&display=swap" rel="stylesheet">

<style>
/* ===== Design tokens ===== */
:root{
  --ink:#eef3ff; --ink-dim:#cfd3e1; --muted:rgba(238,243,255,.78);
  --bg:#000; --panel:#0a0c10; --stroke:rgba(255,255,255,.18);
  --blue:#0A84FF; --green:#32d74b; --red:#ff3b30; --chip:#1b1f2a;
  --gold:#ffd700; --silver:#c0c7d1;

  --gap:12px; --r:14px; --maxw:1240px; --nav-h:68px;
  --hero-pad:16px;
  --btn-h:44px; --btn-bottom:14px; --chip-h:36px;

  /* Overlays */
  --z-overlay:12000;    /* topmost layer */
  --z-nav:200;
}

/* ===== Reset / base ===== */
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent }
html,body{ height:100% }
html{ background:var(--bg) }
body{
  margin:0; color:var(--ink);
  background:var(--bg);
  font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif;
}
a{ color:inherit; text-decoration:none }
button{ font:inherit; color:inherit; cursor:pointer; background:none; border:0 }
img{ max-width:100%; display:block }

.no-scroll{ overflow:hidden } /* applied when overlay is open */
[hidden]{ display:none !important }

/* ===== Top nav ===== */
.nav{
  position:fixed; top:0; left:0; right:0; height:var(--nav-h);
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 16px; z-index:var(--z-nav);
  background:linear-gradient(180deg, rgba(0,0,0,.7), rgba(0,0,0,0));
  backdrop-filter: blur(6px);
}
.nav .left, .nav .right{ display:flex; align-items:center; gap:8px }
.nav .title{ font:700 18px/1 Raleway,system-ui; letter-spacing:.3px }
.icon-btn{
  display:inline-flex; align-items:center; justify-content:center;
  height:40px; width:40px; border-radius:12px;
  border:1px solid var(--stroke); background:rgba(255,255,255,.04);
}
.primary{
  padding:0 14px; height:40px; border-radius:12px;
  border:1px solid var(--stroke); background:rgba(255,255,255,.06);
}

/* ===== Page wrap ===== */
.wrap{ position:relative; z-index:1; padding:calc(var(--nav-h) + 24px) 20px 80px; max-width:var(--maxw); margin:0 auto }

/* ===== Section + row (hero carousel) ===== */
.section{ margin-top:18px }
.section-title{
  display:flex; align-items:center; gap:10px;
  margin:10px 2px; font:800 18px/1.2 Raleway,system-ui; letter-spacing:.2px
}
.section-title .aud{ font:700 11px/1 Oswald,system-ui; padding:7px 9px; border-radius:999px; border:1px solid var(--stroke); background:rgba(255,255,255,.04) }
.row{
  display:grid; grid-auto-flow:column; grid-auto-columns: clamp(160px, 30vw, 240px);
  gap:12px; overflow-x:auto; overscroll-behavior-x:contain; scroll-snap-type:x mandatory; padding-bottom:6px;
}
.row::-webkit-scrollbar{ height:8px }
.row::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.12); border-radius:20px }

.hero{
  position:relative; border-radius:16px; overflow:hidden; min-height:160px;
  border:1px solid var(--stroke); background:rgba(255,255,255,.04);
  display:flex; flex-direction:column; justify-content:flex-end;
  scroll-snap-align:start;
}
.hero .meta{ padding:14px }
.hero .title{ font-weight:800; letter-spacing:.2px }
.hero .sub{ color:var(--ink-dim); font-size:13px; margin-top:4px }
.hero .controls{
  position:absolute; top:10px; right:10px; display:flex; gap:6px;
}
.kebab-btn, .chip-btn{
  height:34px; min-width:34px; border-radius:10px; border:1px solid var(--stroke);
  background:rgba(0,0,0,.35); display:inline-flex; align-items:center; justify-content:center; padding:0 10px;
}
.badge{
  position:absolute; left:10px; top:10px; padding:6px 10px; border-radius:10px;
  border:1px solid var(--stroke); background:rgba(0,0,0,.35); font-size:12px;
}

/* ===== Footer / archive strip ===== */
.footer{
  position:fixed; left:0; right:0; bottom:0;
  display:flex; align-items:center; justify-content:center;
  gap:10px; padding:10px; z-index:var(--z-nav);
  background:linear-gradient(0deg, rgba(0,0,0,.7), rgba(0,0,0,0));
  backdrop-filter: blur(6px);
}
.footer .chip{
  height:36px; border-radius:999px; display:inline-flex; align-items:center; gap:8px; padding:0 12px;
  border:1px solid var(--stroke); background:rgba(255,255,255,.06);
}

/* ===== Chips + dev indicators ===== */
.dev-border{ outline:2px solid #0af; outline-offset:-2px }       /* DEV only (visible when dev mode) */
.progress-border{ box-shadow:inset 0 0 0 2px var(--green) }      /* In-progress green border */

/* ===== Overlay system: single topmost layer ===== */
.overlay-root{
  position:fixed; inset:0; z-index:var(--z-overlay);
  /* Do NOT transform this element or its ancestors */
  pointer-events:none;               /* disabled until active */
}
.overlay-root.active{ pointer-events:auto }

/* Backdrop that blocks interaction behind */
.overlay-backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,.45);
  -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
}

/* Any floating window/dialog/menu is portaled here and absolutely/fixed positioned */
.ui-window{
  position:fixed; max-width:min(92vw, 520px); min-width:280px;
  border-radius:16px; border:1px solid var(--stroke); background:rgba(12,14,18,.98);
  box-shadow: 0 22px 60px rgba(0,0,0,.55), 0 2px 0 rgba(255,255,255,.08) inset;
  overflow:hidden; z-index:calc(var(--z-overlay) + 1);
  contain: layout paint; isolation:isolate; /* self-contained stacking */
}
.ui-window .win-head{ padding:14px 16px; font-weight:800; border-bottom:1px solid rgba(255,255,255,.12) }
.ui-window .win-body{ padding:12px 16px }
.ui-window .win-actions{ display:flex; justify-content:flex-end; gap:10px; padding:12px 16px; border-top:1px solid rgba(255,255,255,.12) }
.ui-item{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px }
.ui-item:active{ background:rgba(255,255,255,.06) }

/* Kebab menu look (narrow) */
.ui-menu{ min-width:240px; max-width: min(92vw, 360px) }

/* Drawer variant (templates/archive) */
.ui-drawer{
  position:fixed; left:0; right:0; bottom:0; max-width:none; min-width:0; border-radius:16px 16px 0 0;
}

/* Defensive: ensure normal page pieces never beat overlay */
.header, .nav, .chip, .hero, .settings-bar, .footer, .section-title { z-index:auto }

/* Simple icons */
.i{ font-weight:900; font-family:system-ui, -apple-system, "SF Pro"; }
.i.kebab::before{ content:"‚ãØ" }
.i.close::before{ content:"‚úï" }
.i.play::before{ content:"‚ñ∫" }
.i.more::before{ content:"‚ñæ" }
.i.cog::before{ content:"‚öô" }
.i.folder::before{ content:"üóÇ" }
.i.templates::before{ content:"üìë" }
.i.star::before{ content:"‚òÖ" }
.i.share::before{ content:"‚á™" }
.i.hide::before{ content:"üö´" }
.i.role::before{ content:"üéö" }
.i.view::before{ content:"üëÅ" }
.i.admin::before{ content:"üõ°" }

/* Role chips */
.role-chip{
  height:34px; border-radius:999px; border:1px solid var(--stroke);
  display:inline-flex; align-items:center; gap:8px; padding:0 12px; background:rgba(255,255,255,.06); font-size:13px;
}

/* Accessibility helpers */
.visually-hidden{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap }
</style>
</head>
<body>

<!-- ===== Top Nav ===== -->
<nav class="nav" aria-label="Top navigation">
  <div class="left">
    <button class="primary" id="btnMenu" aria-haspopup="menu" aria-controls="mainMenu">
      <span class="i more" aria-hidden="true"></span>&nbsp; Menu
    </button>
    <div class="title">Fine Arts Online Academy</div>
  </div>
  <div class="right">
    <button class="icon-btn" id="btnRole" aria-haspopup="menu" title="Change level/view">
      <span class="i role" aria-hidden="true"></span>
      <span class="visually-hidden">Change level</span>
    </button>
    <button class="icon-btn" id="btnSettings" aria-haspopup="dialog" title="Settings">
      <span class="i cog" aria-hidden="true"></span>
      <span class="visually-hidden">Settings</span>
    </button>
  </div>
</nav>

<!-- ===== Content ===== -->
<main class="wrap" id="main">
  <section class="section">
    <div class="section-title">
      <div>Continue learning</div>
      <div class="aud">All levels</div>
    </div>
    <div class="row" id="rowContinue">
      <!-- Sample hero cards -->
      <article class="hero progress-border" data-id="c1">
        <div class="badge">Course 1</div>
        <div class="controls">
          <button class="kebab-btn" aria-label="More options" data-kebab-for="c1"><span class="i kebab"></span></button>
        </div>
        <div class="meta">
          <div class="title">Gesture Essentials</div>
          <div class="sub">12/30 complete</div>
        </div>
      </article>

      <article class="hero" data-id="c2">
        <div class="badge">Course 2</div>
        <div class="controls">
          <button class="kebab-btn" aria-label="More options" data-kebab-for="c2"><span class="i kebab"></span></button>
        </div>
        <div class="meta">
          <div class="title">Charcoal Portraits</div>
          <div class="sub">Start now</div>
        </div>
      </article>

      <article class="hero" data-id="c3">
        <div class="badge">Course 3</div>
        <div class="controls">
          <button class="kebab-btn" aria-label="More options" data-kebab-for="c3"><span class="i kebab"></span></button>
        </div>
        <div class="meta">
          <div class="title">Ink & Movement</div>
          <div class="sub">New</div>
        </div>
      </article>
    </div>
  </section>

  <section class="section">
    <div class="section-title">
      <div>Recommended for you</div>
      <div class="aud">Beginner ‚Ä¢ Intermediate</div>
    </div>
    <div class="row" id="rowRecs">
      <article class="hero" data-id="r1">
        <div class="badge">Beginner</div>
        <div class="controls"><button class="kebab-btn" aria-label="More options" data-kebab-for="r1"><span class="i kebab"></span></button></div>
        <div class="meta"><div class="title">Edges & Shapes</div><div class="sub">Quick study</div></div>
      </article>
      <article class="hero" data-id="r2">
        <div class="badge">Intermediate</div>
        <div class="controls"><button class="kebab-btn" aria-label="More options" data-kebab-for="r2"><span class="i kebab"></span></button></div>
        <div class="meta"><div class="title">Dynamic Lines</div><div class="sub">Try next</div></div>
      </article>
      <article class="hero" data-id="r3">
        <div class="badge">Advanced</div>
        <div class="controls"><button class="kebab-btn" aria-label="More options" data-kebab-for="r3"><span class="i kebab"></span></button></div>
        <div class="meta"><div class="title">Mixed Media Flow</div><div class="sub">Workshop</div></div>
      </article>
    </div>
  </section>
</main>

<!-- ===== Footer chips (Archive label clickable + Templates drawer) ===== -->
<footer class="footer" aria-label="Footer">
  <button class="chip" id="btnArchive"><span class="i folder"></span> Archive</button>
  <button class="chip" id="btnTemplates"><span class="i templates"></span> Templates</button>
  <span class="chip" id="chipDevToggle" data-dev="off" title="Developer tools (toggle)">DEV</span>
</footer>

<!-- ===== Overlay Root (THE ONLY place windows live) ===== -->
<div id="overlay" class="overlay-root" hidden aria-hidden="true">
  <div class="overlay-backdrop" id="overlayBackdrop"></div>
  <!-- Portaled windows land here -->
</div>

<!-- ===== TEMPLATES: Windows/Dialogs/Menus (will be portaled) ===== -->

<!-- Main menu -->
<div id="mainMenu" class="ui-window ui-menu" data-window data-role="menu" hidden>
  <div class="win-head">Menu</div>
  <div class="win-body">
    <div class="ui-item"><span class="i play"></span> Continue</div>
    <div class="ui-item"><span class="i star"></span> Favourites</div>
  </div>
  <div class="win-actions">
    <button class="primary" data-close>Close</button>
  </div>
</div>

<!-- Role/View menu (Beginner..Admin) -->
<div id="roleMenu" class="ui-window ui-menu" data-window data-role="menu" hidden>
  <div class="win-head">Level & View</div>
  <div class="win-body" id="roleList">
    <!-- populated by JS -->
  </div>
  <div class="win-actions">
    <button class="primary" data-close>Done</button>
  </div>
</div>

<!-- Settings dialog -->
<div id="settingsDialog" class="ui-window" data-window role="dialog" aria-modal="true" hidden>
  <div class="win-head">Settings</div>
  <div class="win-body">
    <label style="display:block; margin-bottom:8px">
      <span>Reduced motion</span>
      <input type="checkbox" id="reducedMotion">
    </label>
    <label style="display:block; margin-bottom:8px">
      <span>High contrast chips</span>
      <input type="checkbox" id="highContrast">
    </label>
  </div>
  <div class="win-actions">
    <button data-close>Close</button>
  </div>
</div>

<!-- Templates drawer -->
<div id="templatesDrawer" class="ui-window ui-drawer" data-window hidden>
  <div class="win-head">Templates</div>
  <div class="win-body">
    <p>Starter templates coming soon: course card, challenge, weekly drops.</p>
  </div>
  <div class="win-actions">
    <button data-close>Close</button>
  </div>
</div>

<!-- Archive (opens a simple dialog for now) -->
<div id="archiveDialog" class="ui-window" data-window role="dialog" aria-modal="true" hidden>
  <div class="win-head">Archive</div>
  <div class="win-body">
    <p>Previously featured content lives here offline.</p>
  </div>
  <div class="win-actions">
    <button data-close>Close</button>
  </div>
</div>

<!-- Kebab menu template (reused for each card) -->
<div id="kebabMenuTpl" class="ui-window ui-menu" data-window hidden>
  <div class="win-head">Card options</div>
  <div class="win-body">
    <div class="ui-item" data-act="continue"><span class="i play"></span> Continue</div>
    <div class="ui-item" data-act="fav"><span class="i star"></span> Add to Favourites</div>
    <div class="ui-item" data-act="share"><span class="i share"></span> Share</div>
    <div class="ui-item" data-act="hide"><span class="i hide"></span> Hide</div>
  </div>
  <div class="win-actions"><button data-close>Close</button></div>
</div>

<script>
/* ================================
   FAOA Window Manager (no bleed)
   ================================ */
(() => {
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  const overlay = $("#overlay");
  const backdrop = $("#overlayBackdrop");
  const main = $("#main") || document.body;

  let openStack = [];           // track windows for focus restore
  let lastFocus = null;

  // ---- Portal any [data-window] into overlay on init
  const windows = $$("[data-window]");
  windows.forEach(w => overlay.appendChild(w));

  // ---- Global open/close API
  window.UI = {
    open(win, opts={}){ openWindow(win, opts); },
    close(win){ closeWindow(win); },
    closeAll(){ while(openStack.length) closeWindow(openStack[openStack.length-1]); }
  };

  function ensureOverlayActive(){
    if (overlay.hidden){
      overlay.hidden = false;
      overlay.classList.add("active");
      overlay.setAttribute("aria-hidden", "false");
      document.body.classList.add("no-scroll");
      setInert(true);
      // Interactions that should close when clicking outside
      backdrop.addEventListener("click", onBackdrop, { once:false });
      document.addEventListener("keydown", onKey, { once:false });
      lastFocus = document.activeElement;
    }
  }
  function maybeDeactivateOverlay(){
    if (!openStack.length){
      overlay.classList.remove("active");
      overlay.hidden = true;
      overlay.setAttribute("aria-hidden", "true");
      document.body.classList.remove("no-scroll");
      backdrop.removeEventListener("click", onBackdrop);
      document.removeEventListener("keydown", onKey);
      setInert(false);
      if (lastFocus && document.contains(lastFocus)) lastFocus.focus();
      lastFocus = null;
    }
  }

  // Position a window (menu near trigger; dialog centered; drawer at bottom)
  function place(win, opts){
    const kindDrawer = win.classList.contains("ui-drawer");
    const menu = win.classList.contains("ui-menu");
    const pad = 10;

    if (kindDrawer){
      win.style.left = "0"; win.style.right = "0";
      win.style.bottom = "0"; win.style.top = "auto";
      return;
    }

    if (menu && opts.anchorRect){
      const r = opts.anchorRect;
      const vpW = window.innerWidth, vpH = window.innerHeight;
      const approxW = Math.min(360, Math.max(240, vpW*0.6));
      const approxH = 240;
      let x = Math.min(vpW - pad - approxW, Math.max(pad, r.right - 4));
      let y = Math.min(vpH - pad - approxH, Math.max(pad, r.bottom + 8));
      win.style.left = x + "px";
      win.style.top  = y + "px";
    } else {
      // centered dialog
      const vpW = window.innerWidth, vpH = window.innerHeight;
      win.style.left = Math.max(pad, (vpW - win.offsetWidth)/2) + "px";
      win.style.top  = Math.max(pad, (vpH - win.offsetHeight)/2) + "px";
    }
  }

  function trapFocus(win){
    // Very small focus trap: cycle within win
    const focusables = $$("button,[href],input,select,textarea,[tabindex]:not([tabindex='-1'])", win)
      .filter(el => !el.hasAttribute("disabled"));
    if (focusables.length) focusables[0].focus();
    function onKeyTrap(e){
      if (e.key !== "Tab") return;
      const first = focusables[0], last = focusables[focusables.length-1];
      if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
    }
    win._trap = onKeyTrap;
    win.addEventListener("keydown", onKeyTrap);
  }

  function untrapFocus(win){
    if (win._trap) win.removeEventListener("keydown", win._trap);
    delete win._trap;
  }

  function openWindow(winOrId, opts={}){
    const win = typeof winOrId === "string" ? $("#"+winOrId) : winOrId;
    if (!win) return;
    ensureOverlayActive();
    win.hidden = false;
    win.style.display = "block";
    // initial offscreen to measure
    win.style.left = "-9999px"; win.style.top = "-9999px";
    // after paint, place precisely
    requestAnimationFrame(() => place(win, opts));
    trapFocus(win);
    openStack.push(win);
    // close buttons
    $$("[data-close]", win).forEach(btn => btn.addEventListener("click", () => closeWindow(win), { once:true }));
  }

  function closeWindow(win){
    if (!win || win.hidden) return;
    untrapFocus(win);
    win.hidden = true;
    win.style.display = "none";
    openStack = openStack.filter(w => w !== win);
    maybeDeactivateOverlay();
  }

  function onBackdrop(e){
    // Close top-most window only
    const top = openStack[openStack.length-1];
    if (top) closeWindow(top);
  }
  function onKey(e){
    if (e.key === "Escape"){
      const top = openStack[openStack.length-1];
      if (top) closeWindow(top);
    }
  }

  // Make background inert (fallback)
  function setInert(isInert){
    if ('inert' in HTMLElement.prototype){
      [...document.body.children].forEach(el => { if (el !== overlay) el.inert = isInert; });
    } else {
      if (isInert){ main.setAttribute("aria-hidden","true"); }
      else { main.removeAttribute("aria-hidden"); }
    }
  }

  /* ===== Wire buttons/menus ===== */
  $("#btnMenu")?.addEventListener("click", (e)=>{
    const rect = e.currentTarget.getBoundingClientRect();
    UI.open("mainMenu", { anchorRect: rect });
  });

  $("#btnSettings")?.addEventListener("click", ()=> UI.open("settingsDialog"));

  // Templates + Archive drawers/dialogs
  $("#btnTemplates")?.addEventListener("click", ()=> UI.open("templatesDrawer"));
  $("#btnArchive")?.addEventListener("click", ()=> UI.open("archiveDialog"));

  // Kebab per card: reuse the kebab template
  const kebabTpl = $("#kebabMenuTpl");
  document.addEventListener("click", (e)=>{
    const btn = e.target.closest("[data-kebab-for]");
    if (!btn) return;
    const rect = btn.getBoundingClientRect();
    UI.open(kebabTpl, { anchorRect: rect });
  });

  kebabTpl.addEventListener("click", (e)=>{
    const item = e.target.closest("[data-act]");
    if (!item) return;
    const act = item.getAttribute("data-act");
    console.log("kebab action:", act);
    UI.close(kebabTpl);
  });

  /* ===== Role / View logic ===== */
  const ROLES = ["beginner","intermediate","advanced","support","director","admin"];
  const store = {
    get(k, d){ try{ return JSON.parse(localStorage.getItem(k)) ?? d }catch{ return d } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)) }
  };
  const K = { profile:"faoa_profile", viewAs:"faoa_view_as", dev:"faoa_dev" };

  function baseRole(){
    const p = store.get(K.profile, { skill:"beginner", displayName:"User" });
    return (p.skill || "beginner").toLowerCase();
  }
  function viewOverride(){ return (store.get(K.viewAs, "") || "").toLowerCase(); }
  function getRole(){
    const override = viewOverride();
    // If dev toggle is ON, allow view-as; else use base
    const devOn = store.get(K.dev, false);
    if (devOn && override) return override;
    return baseRole();
  }

  // Populate role menu
  const roleList = $("#roleList");
  function renderRoleMenu(){
    roleList.innerHTML = "";
    ROLES.forEach(r=>{
      const btn = document.createElement("button");
      btn.className = "ui-item";
      btn.type = "button";
      btn.dataset.role = r;
      let label = r.charAt(0).toUpperCase() + r.slice(1);
      btn.innerHTML = `<span class="i view"></span> ${label}`;
      btn.addEventListener("click", ()=>{
        // Admin gate: require code 7931
        if (r === "admin"){
          gateAdmin().then(ok=>{
            if (ok){ store.set(K.viewAs, r); UI.close("roleMenu"); refreshRoleChip(); }
          });
        } else {
          store.set(K.viewAs, r);
          UI.close("roleMenu"); refreshRoleChip();
        }
      });
      roleList.appendChild(btn);
    });
  }
  async function gateAdmin(){
    // Simple passcode prompt window (uses existing overlay)
    const ask = document.createElement("div");
    ask.className = "ui-window";
    ask.setAttribute("data-window","");
    ask.innerHTML = `
      <div class="win-head">Admin code</div>
      <div class="win-body">
        <p>Enter the admin code to switch to Admin. Wrong code will revert to Bronze.</p>
        <input id="adminCode" type="password" placeholder="4-digit code" style="width:100%; padding:10px; border-radius:10px; border:1px solid var(--stroke); background:#0b0e13; color:var(--ink)">
      </div>
      <div class="win-actions">
        <button data-close>Skip</button>
        <button id="adminSubmit" class="primary">Enter</button>
      </div>`;
    overlay.appendChild(ask);
    return new Promise(resolve=>{
      UI.open(ask);
      ask.querySelector("#adminSubmit").addEventListener("click", ()=>{
        const val = (ask.querySelector("#adminCode").value || "").trim();
        const ok = (val === "7931");
        if (!ok){ store.set(K.viewAs,"beginner"); }
        UI.close(ask);
        ask.remove();
        resolve(ok);
      }, { once:true });
      ask.querySelector("[data-close]").addEventListener("click", ()=>{
        store.set(K.viewAs,"beginner"); UI.close(ask); ask.remove(); resolve(false);
      }, { once:true });
    });
  }

  function refreshRoleChip(){
    const role = getRole();
    const chip = $("#btnRole");
    chip.title = "Level: " + role;
  }

  // DEV toggle in footer
  const devChip = $("#chipDevToggle");
  function syncDevChip(){
    const on = !!store.get(K.dev, false);
    devChip.dataset.dev = on ? "on" : "off";
    devChip.textContent = on ? "DEV ON" : "DEV";
    document.body.classList.toggle("dev-on", on);
  }
  devChip.addEventListener("click", ()=>{
    const on = !!store.get(K.dev, false);
    store.set(K.dev, !on); syncDevChip();
  });

  $("#btnRole").addEventListener("click", (e)=>{
    renderRoleMenu();
    const rect = e.currentTarget.getBoundingClientRect();
    UI.open("roleMenu", { anchorRect: rect });
  });

  // Init
  syncDevChip();
  refreshRoleChip();

})();
</script>
</body>
</html>